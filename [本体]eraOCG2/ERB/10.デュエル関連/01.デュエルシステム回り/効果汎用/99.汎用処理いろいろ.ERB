@RESETCONDITION_MAT(ARG)
;효과条件リセット：

VARSET 素材条件名前
VARSET 素材条件固名前起動
VARSET 素材条件固名前

VARSET 素材条件固場所, -1
VARSET 素材条件固定, -1

VARSET 素材条件R종족起動
VARSET 素材条件R속성起動
VARSET 素材条件R속성
VARSET 素材条件R종족

VARSET 素材条件カテゴリ
VARSET 反素材条件カテゴリ
VARSET 素材条件分割, -1
VARSET 素材条件종류, -1

VARSET 素材条件종족起動
VARSET 素材条件素材数起動
VARSET 素材条件素材攻撃力起動
VARSET 素材条件素材ID起動 ;Anonym추가
VARSET 素材条件속성
VARSET 素材条件종족

VARSET 素材条件召種
VARSET 素材条件T1召種


VARSET 素材条件同レベル起動 
VARSET 素材条件レベル, -1
VARSET 素材条件링크, -1

VARSET 素材条件攻撃力, -1
VARSET 素材条件以攻撃力, -1
VARSET 素材条件守備力, -1
VARSET 素材条件以守備力, -1
VARSET 素材条件튜너
VARSET 素材条件성별
VARSET 素材条件装備

VARSET 素材条件スーパー속성
VARSET 素材条件スーパー종류
VARSET 素材条件スーパーカテゴリ
VARSET 素材条件スーパー名前
VARSET 素材条件スーパー표시
VARSET 素材条件スーパー상대モン

IF ARG == 0
	VARSET 重ねてＸ
	VARSET なんでもＸ
	VARSET 必要素材数
	VARSET 代替素材数
	VARSET 지정素材カテゴリ
	VARSET 지정素材名前
	VARSET 지정素材속성
	VARSET 지정素材종족
	VARSET 지정素材종류
	VARSET 지정素材汎数
	VARSET 素材条件数自由
	VARSET 효과추가종류, -1
	VARSET 素材条件L値無視
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@RESETAREA_MAT
;PRINTFORML エリアリセット！
VARSET 素材範囲필드
VARSET 素材範囲손패
VARSET 素材範囲묘지
VARSET 素材範囲마함
VARSET 素材範囲덱
VARSET 素材範囲EX덱
VARSET 素材範囲제외

VARSET 素材範囲상대필드
VARSET 素材範囲상대손패
VARSET 素材範囲상대묘지
VARSET 素材範囲상대마함
VARSET 素材範囲상대덱
VARSET 素材範囲상대EX덱
VARSET 素材範囲상대제외

VARSET 素材範囲解除
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@FULLRESET
CALL RESETAREA
CALL RESETCONDITION

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@RESETCONDITION
;효과条件リセット：
VARSET 효과条件ID,-1
VARSET 효과条件固ID,-1
VARSET 효과条件名前
VARSET 효과条件固名前 
VARSET 효과条件カテゴリ
VARSET 효과条件スーパー名前
VARSET 효과条件スーパーカテゴリ
VARSET 효과条件スーパー종류
VARSET 효과条件スーパー튜너
VARSET 효과条件スーパー속성, -1
VARSET 효과条件スーパー종족, -1
VARSET 효과条件スーパーレベル, -1
VARSET 효과条件スーパー攻撃力
VARSET 효과条件固カテゴリ

VARSET 효과条件종류, -1
VARSET 효과条件分割, -1
VARSET 효과条件同攻守, -1

VARSET 효과条件속성, -1
VARSET 효과条件종족, -1
VARSET 효과条件レベル, -1
VARSET 효과条件変レベル, -1
VARSET 효과条件攻撃力
VARSET 효과条件以攻撃力, -1
VARSET 효과条件固攻撃力, -1
VARSET 효과条件元固攻撃力, -1

VARSET 효과条件守備力
VARSET 효과条件以守備力, -1
VARSET 효과条件固守備力, -1
VARSET 효과条件元固守備力, -1
VARSET 효과条件표시, -1
VARSET 효과条件複数
VARSET 효과条件選択済,-1
VARSET 효과条件行先플래그
VARSET 효과条件추가플래그
VARSET 효과条件装備先,-1

VARSET 효과条件召種, -1
VARSET 효과条件T1召種
VARSET 효과条件튜너
VARSET 효과条件除去種
VARSET 효과条件個Ｃ所持
VARSET 효과条件魔Ｃ所持
VARSET 효과条件悪Ｃ所持
VARSET 효과条件薬Ｃ所持

VARSET 효과条件条件達生

VARSET 효과条件Ｘ素所持
VARSET 효과条件성별, -1
VARSET 효과条件発情, -1

VARSET 효과条件任意
VARSET 효과条件固定, -1

VARSET 효과条件소환可, -1
VARSET 효과条件他所, -1

VARSET 효과条件山切り無し
VARSET 효과条件固名前起動
VARSET 효과条件固名前選択
VARSET 효과条件特不無視
VARSET 효과条件상대モン
VARSET 효과条件RUM
VARSET 효과条件어둠융합
VARSET 효과条件重ねてＸ
VARSET 효과条件CNT
VARSET 효과条件限界値
VARSET 효과条件RND

VARSET 효과추가종류, -1
VARSET 효과추가カテ
VARSET 효과元カードID
VARSET 효과条件攻撃可
VARSET 효과설정改名
VARSET 효과条件うらら解除

VARSET 強制必要素材名前
VARSET 強制必要素材名前２


VARSET 強制素材場所,-1
VARSET 強制素材場所２,-1
VARSET 強制素材禁止場所,-1

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@RESETAREA
VARSET 효과範囲필드
VARSET 효과範囲마함
VARSET 효과範囲손패
VARSET 효과範囲묘지
VARSET 효과範囲덱
VARSET 효과範囲EX덱
VARSET 효과範囲제외

VARSET 효과範囲상대필드
VARSET 효과範囲상대마함
VARSET 효과範囲상대손패
VARSET 효과範囲상대묘지
VARSET 효과範囲상대덱
VARSET 효과範囲상대EX덱
VARSET 효과範囲상대제외


@CHECK_COND
SIF 효과条件名前 != ""
	RETURN 1
SIF 효과条件カテゴリ != ""
	RETURN 1
SIF 효과条件分割 > 0
	RETURN 1
SIF 효과条件종류  > 0
	RETURN 1
SIF 효과条件속성 != -1
	RETURN 1
SIF 효과条件종족 != -1
	RETURN 1
SIF 효과条件レベル != -1
	RETURN 1
SIF 효과条件攻撃力 != 0
	RETURN 1
SIF 효과条件以攻撃力 != -1
	RETURN 1
SIF 효과条件固攻撃力 != -1
	RETURN 1
SIF 효과条件元固攻撃力 != -1
	RETURN 1
SIF 효과条件守備力 != 0
	RETURN 1
SIF 효과条件以守備力 != -1
	RETURN 1
SIF 효과条件元固守備力 != -1
	RETURN 1
RETURN 0
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――



;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@RESETCONDITION_EXT

;濾過条件リセット：
VARSET 濾過条件名前
VARSET 濾過条件固名前 
VARSET 濾過条件カテゴリ
VARSET 反濾過条件カテゴリ

VARSET 濾過条件종류, -1
VARSET 濾過条件속성, -1
VARSET 濾過条件종족, -1
VARSET 濾過条件レベル, -1
VARSET 濾過条件攻撃力
VARSET 濾過条件以攻撃力, -1
VARSET 濾過条件攻固撃力, -1
VARSET 濾過条件守備力, -1
VARSET 濾過条件튜너
VARSET 濾過条件표시, -1
VARSET 濾過条件複数選択, -1
VARSET 濾過条件召種, -1

VARSET 濾過条件固定, -1
VARSET 濾過条件強制, -1
VARSET 濾過条件성별, -1
VARSET 濾過条件소환可, -1
VARSET 濾過종류특수소환, -1
VARSET 濾過条件他所, -1

VARSET 濾過条件의식無視
VARSET 濾過条件CNT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@RESETAREA_EXT
VARSET 濾過範囲필드
VARSET 濾過範囲마함
VARSET 濾過範囲손패
VARSET 濾過範囲묘지
VARSET 濾過範囲덱
VARSET 濾過範囲EX덱
VARSET 濾過範囲제외

VARSET 濾過範囲상대필드
VARSET 濾過範囲상대마함
VARSET 濾過範囲상대손패
VARSET 濾過範囲상대묘지
VARSET 濾過範囲상대덱
VARSET 濾過範囲상대EX덱

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――


@FULLRESET_EXT
CALL RESETAREA_EXT
CALL RESETCONDITION_EXT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@SHUFFLE(듀얼리스트)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC CHANGE
;LCOUNTは덱枚数の値에서1づつ下げていく

PRINTFORML %듀얼리스트%의 덱을 셔플합니다。

SELECTCASE 듀얼리스트
	CASE "자신"
		FOR LCOUNT, 現山札数("자신"), 0, -1
			;0以上LCOUNT未満の数에서ランダムでシャッフル대상을 選ぶ
			CHANGE = RAND:LCOUNT
			SWAP 자신_덱:(LCOUNT-1), 자신_덱:CHANGE
		NEXT

	CASE "상대"
		FOR LCOUNT, 現山札数("상대"), 0, -1
			CHANGE = RAND:LCOUNT
			SWAP 상대_덱:(LCOUNT-1), 상대_덱:CHANGE
		NEXT
ENDSELECT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_CHOICE(듀얼리스트,종류,ゾーン,場所,カードID,효과番号,Ｘ플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 발동カード名
#DIM DYNAMIC カードID
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC Ｘ플래그
#DIM DYNAMIC 효과番号
#DIM DYNAMIC 選択カード
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 無効불가
#DIM DYNAMIC 開始結果


CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%
;PRINTFORML　듀얼리스트,카드ID：%듀얼리스트%,{カードID}　효과번호：{효과番号}


IF 종류 == 身代효과 || 종류 == 소환誘発 || 종류 == EX덱起動
	無効불가 = 2
ENDIF
IF 효과無効不能 == 1
	無効불가 = 1
	효과無効不能 = 0
ENDIF
IF カードID >= 0
	CALLFORM CHAIN_CAN(듀얼리스트,ゾーン,場所,カードID)
	IF RESULT == 1
		PRINTFORMW 이 카드의 효과 중、%듀얼리스트%는 효과를 발동할 수 없습니다！
		無効불가 = 1
	ENDIF
ENDIF
VARSET RESULT
IF ゾーン != "효과処理" && 종류 != 戦破壊→묘지
	CALL CARD_NEGATE(듀얼리스트,종류,ゾーン,場所,カードID,1)
	IF RESULT == 1
		効後_발동無:処理中番号 = 無効行き
	ENDIF
ENDIF
IF ゾーン == "효과処理" && GROUPMATCH(カードID,50992,50950)
	PRINTFORMW 무한 루프의 위험성이 있기 때문에 강제종료합니다。（카피 효과를 카피한다）
	RETURN 1
ENDIF

IF 듀얼리스트 == "자신" 
	TRYCALLFORM CARD_{カードID}("종류")
	IF INRANGE(RESULT,20,30)
		リザルト：마법발동 = 1
	ELSEIF INRANGE(RESULT, 30, 39) 
		リザルト：함정발동 = 1
	ENDIF
ENDIF

TRYCALLFORM CARDNAME_{カードID}, "名前"
발동カード名 = %RESULTS%

VARSET RESULT

IF 듀얼리스트 == "자신"
	SETCOLOR C_W_BLUE
	CUSTOMDRAWLINE —
	PRINTL
	PRINTFORML 자신은 %ゾーン%에서%발동カード名%의 효과를 발동했습니다！
	PRINTL
	CUSTOMDRAWLINE —
	RESETCOLOR
ELSEIF 듀얼리스트 == "상대"
	;발동確認
	CALL KOJO_MESSAGE_SEND("DUEL",OPPOSER,5,カードID)
	SETCOLOR C_W_RED
	CUSTOMDRAWLINE —
	PRINTL
	PRINTFORML 상대는 %ゾーン%에서 %발동カード名%의 효과를 발동했습니다！
	PRINTL
	CUSTOMDRAWLINE —
	RESETCOLOR
	CALLFORM SELECT_UI_SET(듀얼리스트,カードID,99,場所,종류,ゾーン)
	PRINTW
ENDIF

IF 효과番号 != 0
	IF ゾーン == "효과処理"
		RETURN 0
	ELSEIF GROUPMATCH(효과番号, 1, 2, 3, 4)
		CALL CARD_EFFECT_USE(듀얼리스트,カードID,효과番号)
	ELSEIF 효과番号 == 10
		IF ゾーン == "마함"
			SETVAR @"%듀얼리스트%_魔_効済:場所", 1
		ELSEIF ゾーン == "필드"
			SETVAR @"%듀얼리스트%_MZ_効済:場所", 1
		ENDIF
	ELSEIF 효과番号 == 11
		IF ゾーン == "마함"
			SETVAR @"%듀얼리스트%_魔_効済:場所", 2
		ELSEIF ゾーン == "필드"
			SETVAR @"%듀얼리스트%_MZ_効済:場所", 2
		ENDIF
	ELSEIF 효과番号 == 15
		IF 발동済_1(듀얼리스트,カードID)
			CALL CARD_EFFECT_USE(듀얼리스트,カードID,2)
		ELSE
			CALL CARD_EFFECT_USE(듀얼리스트,カードID,1)
		ENDIF
	ELSEIF 효과番号 == 20
		CALL CARD_EFFECT_D1USE(듀얼리스트,カードID)
	ELSEIF 효과番号 == 21
		CALL CARD_EFFECT_D2USE(듀얼리스트,カードID)
	ELSEIF 효과番号 == 30
		CALL SET_FIELD_INFO(듀얼리스트,ゾーン,場所,"T1汎数",1)
	ENDIF
ENDIF


SIF Ｘ플래그 >= 1
	SETVAR @"%듀얼리스트%_MZ_Ｘ:場所", GETVAR(@"%듀얼리스트%_MZ_Ｘ:場所") - Ｘ플래그


IF ゾーン == "마함"
	SIF GETVAR(@"%듀얼리스트%_魔_表:場所") >= 2
		SETVAR @"%듀얼리스트%_魔_表:場所", 1
ELSEIF ゾーン == "필드"
	SETVAR @"%듀얼리스트%_MZ_効発:場所", 1
ENDIF

SIF 無効불가 == 2
	RETURN 0

IF 종류 == 마함起動 || 종류 == 손패起動
	VARSET RESULT
	TRYCALLFORM CARD_{カードID}("종류")
	IF RESULT == フィールド
		FOR カウンタ,0,5
			SIF GETVAR(@"%듀얼리스트%_마함:カウンタ") == -1
				CONTINUE
			SIF ゾーン == "마함" && カウンタ == 場所
					CONTINUE
			SIF GETVAR(@"%듀얼리스트%_魔_表:カウンタ") >= 2
				CONTINUE
			CALLFORM CARD_{GETVAR(@"%듀얼리스트%_마함:{カウンタ}")}("종류")
			SIF RESULT != フィールド
				CONTINUE
			CALL CARD_DISPOSE(듀얼리스트,"마함",カウンタ)
		NEXT
	ENDIF
ENDIF

IF 無効불가 == 0
	CALLFORM CARD_START(듀얼리스트,종류,ゾーン,場所,カードID)
ELSEIF 無効불가 == 2
	RETURN 0
ENDIF

;カード側の구상（효과成功）
CALL KOJO_MESSAGE_SEND("CARD",カードID,2,종류)
IF 効後_발동無:処理中番号 == 絶対破壊行き
	CALL FULLRESET
	CALL CARD_DISPOSE(듀얼리스트,ゾーン,場所,破壊行き)
ELSEIF 効後_발동無:処理中番号 != 0
	PRINTFORML %듀얼리스트%의%발동カード名%의 효과는 처리할수 없었습니다。
	;PRINTFORML 効後_발동無:{処理中番号}:{効後_발동無:処理中番号}
	;カード側の구상（효과失敗）
	CALL KOJO_MESSAGE_SEND("CARD",カードID,2,종류,1)
	;場所データを読み込まない타입は無視
	IF !GROUPMATCH(종류,필드→묘지,손패→묘지,덱→묘지,破壊→묘지,戦闘→묘지,필드→戦離,제외時,戦破壊→묘지,R素材時효과,F素材時효과,S素材時효과,X素材時효과,L素材時효과)
		IF 効後_발동無:処理中番号 == 無効行き
			TRYCALLFORM CARD_{カードID}("종류")
			IF GROUPMATCH(RESULT,通常마법,速攻마법,通常함정) 
				CALL FULLRESET
				CALL CARD_DISPOSE(듀얼리스트,ゾーン,場所)	
			ENDIF
		ELSEIF 効後_발동無:処理中番号 == 強奪行き
			IF ゾーン == "필드"
				CALL FULLRESET
				CALL CARD_GET_CONTROL(듀얼리스트,場所,0,1)
			ENDIF
		ELSEIF 効後_발동無:処理中番号 == 裏戻行き
			SETVAR @"%듀얼리스트%_魔_表:場所", 3
		ELSE
			CALL FULLRESET
			CALL CARD_DISPOSE(듀얼리스트,ゾーン,場所,効後_발동無:処理中番号)
		ENDIF
	ENDIF
	開始結果 = 1
ENDIF

IF 無効불가 == 2
	RETURN 0
ELSE
	SIF GETVAR(@"%듀얼리스트%_ディール효과")
		CALLFORM CARDEFFECT_12075_1(듀얼리스트)
	SETVAR @"%듀얼리스트%_발동数" , GETVAR(@"%듀얼리스트%_발동数") + 1
	TRYCALLFORM CARD_{カードID}("종류")
	IF RESULT <= 10
		TRYCALLFORM CARD_{カードID}, "分割"
		IF RESULT == 펜듈럼 && 종류 == 손패起動
			CALL SET_PLAYER_INFO(듀얼리스트,"마법발동数",1,0,1)
		ELSE
			CALL SET_PLAYER_INFO(듀얼리스트,"モン발동数",1,0,1)
		ENDIF
	ELSEIF INRANGE(RESULT,20,30)
		CALL SET_PLAYER_INFO(듀얼리스트,"마법발동数",1,0,1)
	ELSEIF INRANGE(RESULT,30,40)
		CALL SET_PLAYER_INFO(듀얼리스트,"함정발동数",1,0,1)
		SIF GETVAR(@"%듀얼리스트%_トラトリ制限") >= 1
			SETVAR @"%듀얼리스트%_함정無効", 1
	ENDIF
	IF ゾーン == "필드"
		IF GETVAR(@"%듀얼리스트%_MZ_召種:場所") == 召種通常 && ターンプレイヤー == 듀얼리스트
			アラメシア顕現불가 = 1
		ENDIF
	ELSEIF ゾーン == "손패"	
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT <= 10
			CALL SET_PLAYER_INFO(듀얼리스트,"손패발동数",1,0,1)
	ELSEIF ゾーン == "묘지"
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT <= 10
			CALL SET_PLAYER_INFO(듀얼리스트,"묘지발동数",1,0,1)
	ENDIF
	IF カードID == 覚醒발동
		SETVAR @"%듀얼리스트%_覚醒횟수", GETVAR(@"%듀얼리스트%_覚醒횟수") + 1
	ENDIF
	CALL CARD_FIN_BIT_SET(듀얼리스트,ゾーン,1)
	CALL CARD_FIN_ID_SET(듀얼리스트,カードID,"효과발동")
	VARSET 処理中_효과ID, -1
	VARSET 処理中_듀얼리스트
	処理中_효과ID = カードID
	処理中_듀얼리스트 = %듀얼리스트%
ENDIF

RETURN 開始結果


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@YN_CHOICE(듀얼리스트,選択:1,選択:2)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 選択,10
PRINTL
IF 듀얼리스트 == "상대"
	CLEARLINE 1
	RETURN 0
ELSE
	IF 選択:1 != ""
		PRINTFORML 효과를 선택해 주세요。
	ENDIF
	IF 選択:1 == ""
		PRINTL [0] - 예
	ELSE
		PRINTFORML [0] - %選択:1%
	ENDIF
	IF 選択:2 == ""
		PRINTL [1] - 아니오
	ELSE
		PRINTFORML [1] - %選択:2%
	ENDIF
	PRINTL
	BINPUT
	RETURN RESULT
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@BATTLE_SETUP(듀얼리스트,選択カード)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 選択カード


IF 듀얼리스트 == "자신"
	자신_戦闘カード = 選択カード
	상대_戦闘カード = 5
ELSE
	자신_戦闘カード = 5
ENDIF
VARSET 자신_ダメージ反射
VARSET 상대_ダメージ反射
VARSET 자신_ダメージ乱反射		
VARSET 상대_ダメージ乱反射
SIF 자신_ダメージ倍化 == 3
	VARSET 자신_ダメージ倍化		
SIF 상대_ダメージ倍化 == 3
	VARSET 상대_ダメージ倍化
SIF 자신_ダメージ半化 == 3
	VARSET 자신_ダメージ半化		
SIF 상대_ダメージ半化 == 3
	VARSET 상대_ダメージ半化

SIF 자신_ダメージ無効 == 3
	VARSET 자신_ダメージ無効		
SIF 상대_ダメージ無効 == 3
	VARSET 상대_ダメージ無効



;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_NEGATE(듀얼리스트,종류,ゾーン,場所,カードID,발동処理中)
;#FUNCTION
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIMS DYNAMIC 対面者
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 발동処理中

SIF 자신_듀얼패배플래그 >= 1 || 상대_듀얼패배플래그 >= 1
	RETURN 1
IF フィールド표시中 == 1
;	PRINTFORML フィールド표시中 = 1
	RETURN 1
ENDIF
IF 듀얼리스트 == "자신"
	対面者 = 상대
ELSEIF 듀얼리스트 == "상대"
	対面者 = 자신
ENDIF


IF 듀얼리스트 == "상대" && 발동処理中 != 1
	CALL ENEMY_RUTIN_EFFECT(종류,ゾーン,場所,カードID)
	SIF RESULT == 1
		RETURN 1
ENDIF

SELECTCASE 듀얼리스트
CASE "자신"
	SIF FINDELEMENT(자신_禁止令, カードID) != -1
		RETURN 1
CASE "상대"
	SIF FINDELEMENT(상대_禁止令, カードID) != -1
		RETURN 1
ENDSELECT
SELECTCASE 듀얼리스트
CASE "자신"
	SIF FINDELEMENT(자신_T1禁止令, カードID) != -1
		RETURN 1
CASE "상대"
	SIF FINDELEMENT(상대_T1禁止令, カードID) != -1
		RETURN 1
ENDSELECT
SELECTCASE 듀얼리스트
CASE "자신"
	SIF FINDELEMENT(자신_C1禁止令, カードID) != -1
		RETURN 1
CASE "상대"
	SIF FINDELEMENT(상대_C1禁止令, カードID) != -1
		RETURN 1
ENDSELECT

;ライオホープ
SIF カードID == 58242
	RETURN 0


SIF 종류 == 付与효과 || 종류 == 필드起動付与 || 종류 == 상대起動付与
	RETURN 0

IF !GROUPMATCH(종류, 攻守変動, 지속효과, 攻紋章起動, 短紋章起動, 永紋章起動, 永攻紋章起動, 時限紋章起動,効後紋章起動)
	IF GETVAR(@"%듀얼리스트%_마함無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT >= 20
			RETURN 1
	ENDIF
	IF GETVAR(@"%듀얼리스트%_モン효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT <= モン全般
			RETURN 1
	ENDIF


	IF GETVAR(@"%듀얼리스트%_魔無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF INRANGE(RESULT,20,30)
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_마법制限") >= 1 && GETVAR(@"%듀얼리스트%_마법발동数") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF INRANGE(RESULT,20,30)
			RETURN 1
	ENDIF


	IF GETVAR(@"%듀얼리스트%_함정無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF INRANGE(RESULT,30,40)
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_通常無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF GROUPMATCH(RESULT,通常마법,通常함정)
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_逆通常無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF GROUPMATCH(RESULT,速攻마법,装備마법,지속마법,フィールド,지속함정)
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_FUS효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT == 융합
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_SYN효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT == 싱크로
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_XYZ효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT == 엑시즈
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_LIN효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT == 링크
			RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT != GETVAR(@"%듀얼리스트%_속성효과無効")
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_빛속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 빛속성
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_어둠속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 어둠속성
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_땅속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 땅속성
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_물속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 물속성
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_화염속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 화염속성
				RETURN 1
		ENDIF
	ENDIF
	IF GETVAR(@"%듀얼리스트%_바람속성효과無効") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		IF RESULT <= 10
			TRYCALLFORM CARD_{カードID}("속성")
			SIF RESULT == 바람속성
				RETURN 1
		ENDIF
	ENDIF



ENDIF


SIF 종류 == 戦破壊→묘지
	RETURN 0


IF ゾーン == "필드"
	IF GETVAR(@"%듀얼리스트%_登場時無効") >= 1
		SIF GROUPMATCH(종류, 소환時,특수소환時,EX소환時)
			RETURN 1
	ENDIF

	IF !GROUPMATCH(종류, 攻守変動,지속효과,常在無効)
		IF GETVAR(@"%듀얼리스트%_용사縛り") >= 1
			IF GETVAR(@"%듀얼리스트%_MZ_召種:場所") == 召種通常
				RETURN 1
			ENDIF
		ENDIF
		SIF GETVAR(@"%듀얼리스트%_MZ_発無:場所") >= 1
			RETURN 1
	ENDIF



	SIF GETVAR(@"%듀얼리스트%_MZ_表:場所") == 3 && 발동処理中 != 1
		RETURN 1
	IF GETVAR(@"%듀얼리스트%_MZ_無効:場所") >= 1
		IF 발동処理中
			IF GETVAR(@"%듀얼리스트%_MZ_個ID:場所") == 効後_個別ID:処理中番号
				RETURN 1
			ENDIF
		ELSE
			RETURN 1
		ENDIF
	ENDIF
ENDIF




IF ゾーン == "마함"
	SIF GETVAR(@"%듀얼리스트%_魔_無効:場所")  >= 1
		RETURN 1
	TRYCALLFORM CARD_{GETVAR(@"%듀얼리스트%_마함:場所")}("종류")
	IF GETVAR(@"%듀얼리스트%_魔_表:場所") >= 2 && (RESULT == 지속마법 || RESULT == 지속함정 || RESULT == 装備마법 || RESULT == フィールド)
		SIF 종류 != 마함起動
			RETURN 1
	ENDIF

	IF !GROUPMATCH(종류, 攻守変動,지속효과,常在無効)
		SIF GETVAR(@"%듀얼리스트%_魔_発無:場所") >= 1
			RETURN 1
	ENDIF


ENDIF

IF ゾーン == "손패"
	IF GETVAR(@"%듀얼리스트%_魔香효과") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT > 10
			RETURN 1
	ENDIF
	IF GETVAR(@"%듀얼리스트%_逆魔香효과") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT < 10
			RETURN 1
	ENDIF
ENDIF
IF ゾーン == "묘지" 
	SIF GETVAR(@"%듀얼리스트%_묘지_無効")  >= 1
		RETURN 1
	IF GETVAR(@"%듀얼리스트%_魔香효과") >= 1
		TRYCALLFORM CARD_{カードID}("종류")
		SIF RESULT > 10
			RETURN 1
	ENDIF
ENDIF

IF INRANGE(종류,필드→묘지,필드→戦離)
	SIF GETVAR(@"%듀얼리스트%_묘지_無効")  >= 1
		RETURN 1
ENDIF
IF ゾーン == "제외" || 종류 == 제외時
	SIF GETVAR(@"%듀얼리스트%_제외_無効")  >= 1
		RETURN 1
ENDIF


RETURN 0



;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_EFFECT_USE(듀얼리스트,カードID,효과番号)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC 효과番号
#DIM DYNAMIC 繰り返し
$INPUT_LOOP
;발동효과
SELECTCASE 듀얼리스트
	CASE "자신"
		SELECTCASE 효과番号
			CASE 1
				자신_발동済효과_1:자신_발동カウンタ_1 = カードID
				자신_발동カウンタ_1 ++
			CASE 2
				자신_발동済효과_2:자신_발동カウンタ_2 = カードID
				자신_발동カウンタ_2 ++
			CASE 3
				자신_발동済효과_3:자신_발동カウンタ_3 = カードID
				자신_발동カウンタ_3 ++
			CASE 4
				자신_발동済효과_4:자신_발동カウンタ_4 = カードID
				자신_발동カウンタ_4 ++
		ENDSELECT
	CASE "상대"
		SELECTCASE 효과番号
			CASE 1
				상대_발동済효과_1:상대_발동カウンタ_1 = カードID
				상대_발동カウンタ_1 ++
			CASE 2
				상대_발동済효과_2:상대_발동カウンタ_2 = カードID
				상대_발동カウンタ_2 ++
			CASE 3
				상대_발동済효과_3:상대_발동カウンタ_3 = カードID
				상대_발동カウンタ_3 ++
			CASE 4
				상대_발동済효과_4:상대_발동カウンタ_4 = カードID
				상대_발동カウンタ_4 ++
		ENDSELECT
ENDSELECT

SIF 繰り返し >= 1
	RETURN
TRYCALLFORM CARD_{カードID}("別途ID")
IF RESULT > 0
	カードID = RESULT
	繰り返し = 1
	GOTO INPUT_LOOP
ENDIF



@CARD_EFFECT_D1USE(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID

TRYCALLFORM CARD_{カードID}("別途ID")
SIF RESULT > 0
	カードID = RESULT


SELECTCASE 듀얼리스트
	CASE "자신"
		자신_발동済D1:자신_D1カウンタ = カードID
		자신_D1カウンタ ++
	CASE "상대"
		상대_발동済D1:상대_D1カウンタ = カードID
		상대_D1カウンタ ++
ENDSELECT

@CARD_EFFECT_D2USE(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID

TRYCALLFORM CARD_{カードID}("別途ID")
SIF RESULT > 0
	カードID = RESULT


SELECTCASE 듀얼리스트
	CASE "자신"
		자신_발동済D2:자신_D2カウンタ = カードID
		자신_D2カウンタ ++
	CASE "상대"
		상대_발동済D2:상대_D2カウンタ = カードID
		상대_D2カウンタ ++
ENDSELECT



@CARD_EFFECT_PROHIB(듀얼리스트,カードID,反転플래그,T1禁止설정)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者 
#DIM DYNAMIC カードID
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC カウンタ
#DIM DYNAMIC T1禁止설정
CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF 反転플래그 == 1
	듀얼리스트 = %対面者%
ENDIF

TRYCALLFORM CARD_{カードID}("別途ID")
SIF RESULT > 0
	カードID = RESULT

$INPUT_LOOP


IF T1禁止설정 == 0
	SELECTCASE 듀얼리스트
		CASE "자신"
			자신_禁止令:자신_禁カウンタ = カードID
			자신_禁カウンタ ++
		CASE "상대"
			상대_禁止令:상대_禁カウンタ = カードID
			상대_禁カウンタ ++
	ENDSELECT
ELSEIF T1禁止설정 == 1
	SELECTCASE 듀얼리스트
		CASE "자신"
			자신_T1禁止令:자신_T1禁カウンタ = カードID
			자신_T1禁カウンタ ++
		CASE "상대"
			상대_T1禁止令:상대_T1禁カウンタ = カードID
			상대_T1禁カウンタ ++
	ENDSELECT
ELSEIF T1禁止설정 == 2
	SELECTCASE 듀얼리스트
		CASE "자신"
			자신_C1禁止令:자신_C1禁カウンタ = カードID
			자신_C1禁カウンタ ++
		CASE "상대"
			상대_C1禁止令:상대_C1禁カウンタ = カードID
			상대_C1禁カウンタ ++
	ENDSELECT
ENDIF


IF 反転플래그 == 2 && カウンタ == 0
	カウンタ ++
	IF 듀얼리스트 == "자신"
		듀얼리스트 = 상대
	ELSE
		듀얼리스트 = 자신
	ENDIF
	GOTO INPUT_LOOP
ENDIF

@RESET_PROHIB
VARSET 자신_禁止令, -1
VARSET 상대_禁止令, -1
VARSET 자신_禁カウンタ
VARSET 상대_禁カウンタ

VARSET 자신_一時EX可종류番号, 1
VARSET 상대_一時EX可종류番号, 1

VARSET 자신_一時EX可종족番号, 1
VARSET 상대_一時EX可종족番号, 1

VARSET 자신_一時EX可속성番号, 1
VARSET 상대_一時EX可속성番号, 1

VARSET 자신_一時SS可종류番号, 1
VARSET 상대_一時SS可종류番号, 1

VARSET 자신_一時SS可종족番号, 1
VARSET 상대_一時SS可종족番号, 1

VARSET 자신_一時SS可속성番号, 1
VARSET 상대_一時SS可속성番号, 1

VARSET 자신_一時EX制限, 0
VARSET 상대_一時EX制限, 0

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_EX_RESTRICTION(듀얼리스트,カテゴリ)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC カテゴリ
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성
;VARSETで1が立っている状態の종족、
;下のカウンタを回すこと에 따라、소환制限可能な物は1のままで、他は0にされる
;その後別の制限がかかった경우、該当部位以外は安全
;例えば충혹마の곤충・植物の後육화의 효과를 발동했을 경우、곤충족の番号が0になり、植物は1のまま


IF EX소환可能종류 >= 1
	FOR カウンタ,1,10
		VARSET 条件달성
		FOR カウンタB,0,10
			IF カウンタ == EX소환可能종류:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_EX可종류番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET EX소환可能종류, -1

IF EX소환可能속성 >= 1
	FOR カウンタ,1,7
		VARSET 条件달성
		FOR カウンタB,0,7
			IF カウンタ == EX소환可能속성:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_EX可속성番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET EX소환可能속성, -1

IF EX소환可能종족 >= 1
	FOR カウンタ,1,30
		VARSET 条件달성
		FOR カウンタB,0,30
			IF カウンタ == EX소환可能종족:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_EX可종족番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET EX소환可能종족, -1

IF EX소환可能レベル >= 1
	FOR カウンタ,1,20
		VARSET 条件달성
		FOR カウンタB,0,20
			IF カウンタ == EX소환可能レベル:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_EX可レベル番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET EX소환可能レベル, -1


IF カテゴリ != ""
	IF 듀얼리스트 == "자신"
		IF 자신_EX可カテゴリ != カテゴリ
			자신_EX可カテゴリ = %カテゴリ%
			자신_EX制限 ++
		ENDIF
	ELSE
		IF 상대_EX可カテゴリ != カテゴリ
			상대_EX可カテゴリ = %カテゴリ%
			상대_EX制限	++
		ENDIF
	ENDIF
ENDIF





@CARD_SS_RESTRICTION(듀얼리스트,カテゴリ)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC カテゴリ
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성
;VARSETで1が立っている状態の종족、
;カウンタを回すこと에 따라、소환制限可能な要素は1のままで、불가は0に설정される
;その後別の制限がかかった경우、소환制限該当部位以外は安全
;例えば충혹마の곤충・植物の後육화의 효과를 발동했을 경우、곤충족の番号が0になり、植物は1のまま


IF SS소환可能종류 >= 1
	FOR カウンタ,1,40
		VARSET 条件달성
		FOR カウンタB,0,40
			IF カウンタ == SS소환可能종류:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_SS可종류番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET SS소환可能종류, -1

IF SS소환可能속성 >= 1
	FOR カウンタ,1,7
		VARSET 条件달성
		FOR カウンタB,0,7
			IF カウンタ == SS소환可能속성:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_SS可속성番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET SS소환可能속성, -1

IF SS소환可能종족 >= 1
	FOR カウンタ,1,30
		VARSET 条件달성
		FOR カウンタB,0,30
			IF カウンタ == SS소환可能종족:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_SS可종족番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET SS소환可能종족, -1


IF SS소환可能성별 >= 1
	FOR カウンタ,1,3
		VARSET 条件달성
		FOR カウンタB,0,3
			IF カウンタ == SS소환可能성별:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_SS可성별番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET SS소환可能성별, -1

IF SS소환可能レベル >= 1
	FOR カウンタ,1,20
		VARSET 条件달성
		FOR カウンタB,0,20
			IF カウンタ == SS소환可能レベル:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_SS可レベル番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET SS소환可能レベル, -1




IF カテゴリ != ""
	IF 듀얼리스트 == "자신"
		IF 자신_SS可カテゴリ != カテゴリ
			자신_SS可カテゴリ = %カテゴリ%
			자신_SS制限 ++
		ENDIF
	ELSE
		IF 자신_SS可カテゴリ != カテゴリ
			상대_SS可カテゴリ = %カテゴリ%
			상대_SS制限	++		
		ENDIF

	ENDIF
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_NS_RESTRICTION(듀얼리스트,カテゴリ)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC カテゴリ
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성
;VARSETで1が立っている状態の종족、
;カウンタを回すこと에 따라、소환制限可能な要素は1のままで、불가は0に설정される
;その後別の制限がかかった경우、소환制限該当部位以外は安全
;例えば충혹마の곤충・植物の後육화의 효과를 발동했을 경우、곤충족の番号が0になり、植物は1のまま


IF NS소환可能종류 >= 1
	FOR カウンタ,1,40
		VARSET 条件달성
		FOR カウンタB,0,40
			IF カウンタ == NS소환可能종류:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_NS可종류番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET NS소환可能종류, -1

IF NS소환可能속성 >= 1
	FOR カウンタ,1,7
		VARSET 条件달성
		FOR カウンタB,0,7
			IF カウンタ == NS소환可能속성:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_NS可속성番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET NS소환可能속성, -1

IF NS소환可能종족 >= 1
	FOR カウンタ,1,30
		VARSET 条件달성
		FOR カウンタB,0,30
			IF カウンタ == NS소환可能종족:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_NS可종족番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET NS소환可能종족, -1


IF カテゴリ != ""
	IF 듀얼리스트 == "자신"
		IF 자신_NS可カテゴリ != カテゴリ
			자신_NS可カテゴリ = %カテゴリ%
			자신_NS制限 ++
		ENDIF
	ELSE
		IF 자신_NS可カテゴリ != カテゴリ
			상대_NS可カテゴリ = %カテゴリ%
			상대_NS制限	++		
		ENDIF

	ENDIF
ENDIF


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_ATK_RESTRICTION(듀얼리스트,カテゴリ)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC カテゴリ
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성
;VARSETで1が立っている状態の종족、
;下のカウンタを回すこと에 따라、소환制限可能な物は1のままで、他は0にされる
;その後別の制限がかかった경우、該当部位以外は安全
;例えば충혹마の곤충・植物の後육화의 효과를 발동했을 경우、곤충족の番号が0になり、植物は1のまま


IF 攻撃可能종류 >= 1
	FOR カウンタ,1,10
		VARSET 条件달성
		FOR カウンタB,0,10
			IF カウンタ == 攻撃可能종류:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_攻撃可종류番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET 攻撃可能종류, -1

IF 攻撃可能속성 >= 1
	FOR カウンタ,1,7
		VARSET 条件달성
		FOR カウンタB,0,7
			IF カウンタ == 攻撃可能속성:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_攻撃可속성番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET 攻撃可能속성, -1

IF 攻撃可能종족 >= 1
	FOR カウンタ,1,30
		VARSET 条件달성
		FOR カウンタB,0,30
			IF カウンタ == 攻撃可能종족:カウンタB
				条件달성 = 1
				CONTINUE
			ENDIF
		NEXT
		SIF 条件달성 == 1
			CONTINUE
		SETVAR @"%듀얼리스트%_攻撃可종족番号:{カウンタ}", 0
	NEXT
ENDIF
VARSET 攻撃可能종족, -1


IF カテゴリ != ""
	IF 듀얼리스트 == "자신"
		자신_攻撃可カテゴリ = %カテゴリ%
		자신_攻撃制限 ++ 
	ELSE
		상대_攻撃可カテゴリ = %カテゴリ%
		상대_攻撃制限 ++		
	ENDIF
ENDIF


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;EX소환可否判断
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;특수소환されるカードのチェック、通す場合はRETURN 0,불가能である場合はRETURN 1
@CARD_EX_CHECK(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성
#DIM DYNAMIC 자신_종류制限
#DIM DYNAMIC 상대_종류制限

CALL CARD_SS_CHECK(듀얼리스트,カードID,"",1)
;PRINTFORML SS카드 체크:{RESULT}
SIF RESULT == 1
	RETURN 1

IF 듀얼리스트 == "상대"
	CALL ENEMY_RUTIN_EXDECK(カードID)
	SIF RESULT == 1
		RETURN 1
ENDIF

SIF GETVAR(@"%듀얼리스트%_EX制限") >= 2 || GETVAR(@"%듀얼리스트%_一時EX制限") >= 1 || GETVAR(@"%듀얼리스트%_SS소환禁止EX덱") >= 1
	RETURN 1


;ロックチェック
FOR カウンタ,0,5
	SIF GETVAR(@"%듀얼리스트%_필드:カウンタ") == -1
		CONTINUE
NEXT


IF カードID > 0
	CALLFORM CARD_{カードID}, "종류"
	IF GETVAR(@"%듀얼리스트%_EX可종류番号:{RESULT}") == 0
		;PRINTL 종류NG
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "속성"
	IF GETVAR(@"%듀얼리스트%_EX可속성番号:{RESULT}") == 0
		;PRINTL 속성NG
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "종족"
	IF GETVAR(@"%듀얼리스트%_EX可종족番号:{RESULT}") == 0
		;PRINTL 종족NG
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "レベル"
	IF GETVAR(@"%듀얼리스트%_EX可レベル番号:{RESULT}") == 0
		;PRINTL 종족NG
		RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_종류制限") >= 1
		CALLFORM CARD_{カードID}, "종류"
		IF RESULT != GETVAR(@"%듀얼리스트%_종류制限")
			RETURN 1
		ENDIF
	ENDIF


	CALLFORM CARD_{カードID}, "종류"
	IF GETVAR(@"%듀얼리스트%_一時EX可종류番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "속성"
	IF GETVAR(@"%듀얼리스트%_一時EX可속성番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "종족"
	IF GETVAR(@"%듀얼리스트%_一時EX可종족番号:{RESULT}") == 0
		RETURN 1
	ENDIF


	IF GETVARS(@"%듀얼리스트%_EX可カテゴリ") != ""
		CALLFORM CARDNAME_{カードID}, "カテゴリ"
		FOR カウンタB,0,5
			IF RESULTS:カウンタB != ""
				SIF RESULTS:カウンタB == GETVARS(@"%듀얼리스트%_EX可カテゴリ")
					条件달성 ++
			ENDIF
		NEXT
		IF 条件달성 == 0
			RETURN 1
		ENDIF
	ENDIF
ENDIF

RETURN 0


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;NS소환可否判断
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;소환されるカードのチェック、通す場合はRETURN 0,불가能である場合はRETURN 1
@CARD_NS_CHECK(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB


SIF GETVAR(@"%듀얼리스트%_NS制限") >= 2
	RETURN 1

IF カードID > 0
	CALLFORM CARD_{カードID}, "종류"
	IF GETVAR(@"%듀얼리스트%_NS可종류番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "속성"
	IF GETVAR(@"%듀얼리스트%_NS可속성番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "종족"
	IF GETVAR(@"%듀얼리스트%_NS可종족番号:{RESULT}") == 0
		RETURN 1
	ENDIF
ENDIF

RETURN 0



;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;NS소환可否判断
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;소환されるカードのチェック、通す場合はRETURN 0,불가能である場合はRETURN 1
@CARD_NS_CHECK_OK(듀얼리스트,場所)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID
#DIM DYNAMIC カードレベル
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 条件달성

VARSET RESULT
カードID = GETVAR(@"%듀얼리스트%_손패:場所")

TRYCALLFORM CARD_{カードID}("종류")
SIF RESULT >= 3
	RETURN 0

;소환権がある場合と、추가소환権があり、該当카드가 추가召可の場合
IF 소환権 >= 1 || (追소환権 >= 1 && GETVAR(@"%듀얼리스트%_手_召可:場所") >= 1)
	;そもそものNS制約確認
	CALL CARD_NS_CHECK(듀얼리스트,カードID)
	SIF RESULT == 1
		RETURN 0
	;효과소환の確認,NGならそもそもの소환可能を確認
	TRYCALLFORM CARDCAN_{カードID}(듀얼리스트,효과소환,"손패",場所)
	IF RESULT == 1 
		条件달성 += 2
	ENDIF
	TRYCALLFORM CARD_{カードID}("소환불가")
	SIF RESULT == 1
		RETURN 条件달성


	TRYCALLFORM CARD_{カードID}("レベル")
	カードレベル = RESULT
	SIF GETVAR(@"%듀얼리스트%_手_一星:場所") >= 1
		カードレベル -= GETVAR(@"%듀얼리스트%_手_一星:場所")
	SIF カードレベル <= 1
		カードレベル = 1
	SELECTCASE カードレベル
	CASE 0 TO 4
		SIF モンスター数(듀얼리스트) < 5
			条件달성 += 1
	CASE 5 TO 6
		SIF GETVAR(@"%듀얼리스트%_ADV불가") >= 1
			RETURN 0
		SIF モンスター数(듀얼리스트) >= 1
			条件달성 += 1
	CASE 7 TO 99
		SIF GETVAR(@"%듀얼리스트%_ADV불가") >= 1
			RETURN 0
		SIF モンスター数(듀얼리스트) >= 2
			条件달성 += 1
	CASEELSE
		RETURN 0
	ENDSELECT
	IF 条件달성 == 0
		RETURN 0
	ENDIF
ELSE
	RETURN 0
ENDIF
RETURN 条件달성



;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;특수소환（SS）可否判断
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;특수소환된 카드의 체크、넘어갈 경우엔 RETURN 0,불가능한 경우엔 RETURN 1
@CARD_SS_CHECK(듀얼리스트,カードID,ゾーン,EX소환플래그)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC EX소환플래그
#DIM DYNAMIC ミドラーシュ確認
#DIM DYNAMIC 자신_イヴリース確認
#DIM DYNAMIC 상대_イヴリース確認

#DIM DYNAMIC 자신_종류制限
#DIM DYNAMIC 상대_종류制限
#DIM DYNAMIC 자신_종족制限
#DIM DYNAMIC 상대_종족制限
#DIM DYNAMIC 자신_속성制限
#DIM DYNAMIC 상대_속성制限
#DIM DYNAMIC 자신_レベル制限
#DIM DYNAMIC 상대_レベル制限
#DIM DYNAMIC 자신_逆속성制限
#DIM DYNAMIC 상대_逆속성制限
#DIM DYNAMIC 逆속성制限

#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB

#DIMS DYNAMIC 対面者
#DIM DYNAMIC 条件달성

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

SIF GETVAR(@"%듀얼리스트%_SS阻害状態") >= 1
	RETURN 1
SIF GETVAR(@"%듀얼리스트%_光阻害状態") >= 1
	逆속성制限 = 빛속성
SIF モンスター数(듀얼리스트) >= 5 && EX소환플래그 == 0
	RETURN 1

;ターン1、SS制限
IF カードID > 0
	CALLFORM CARD_{カードID}("특수制限")
	IF RESULT == 1
		SELECTCASE 듀얼리스트
			CASE "자신"
				SIF FINDELEMENT(자신_SS済, カードID) != -1
					RETURN 1
			CASE "상대"
				SIF FINDELEMENT(상대_SS済, カードID) != -1
					RETURN 1
		ENDSELECT
	ENDIF
	SELECTCASE 듀얼리스트
		CASE "자신"
			SIF FINDELEMENT(자신_ID制, カードID) != -1
				RETURN 1
		CASE "상대"
			SIF FINDELEMENT(상대_ID制, カードID) != -1
				RETURN 1
	ENDSELECT
ENDIF

;通常ロック、カード2枚による規制など
SIF GETVAR(@"%듀얼리스트%_SS制限") >= 2
	RETURN 1

IF ゾーン == "마함"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止마함") >= 1
		RETURN 1
ENDIF
IF ゾーン == "손패"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止손패") >= 1
		RETURN 1
ENDIF

IF ゾーン == "묘지"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止묘지") >= 1
		RETURN 1
ENDIF

IF ゾーン == "덱"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止덱") >= 1
		RETURN 1
ENDIF
IF ゾーン == "EX덱"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止EX덱") >= 1
		RETURN 1
ENDIF

IF ゾーン == "제외"
	SIF GETVAR(@"%듀얼리스트%_SS소환禁止제외") >= 1
		RETURN 1
ENDIF




IF カードID > 0
	CALLFORM CARD_{カードID}, "単一存在"
	IF RESULT == 1
		FOR カウンタ,0,5
			SIF GETVAR(@"%듀얼리스트%_필드:カウンタ") == カードID
				RETURN 1
		NEXT
	ENDIF

	CALLFORM CARD_{カードID}, "종류"
	IF GETVAR(@"%듀얼리스트%_SS可종류番号:{RESULT}") == 0
		RETURN 1
	ENDIF



	IF GETVAR(@"%듀얼리스트%_종류制限") >= 1
		CALLFORM CARD_{カードID}, "종류"
		IF RESULT != GETVAR(@"%듀얼리스트%_종류制限")
			RETURN 1
		ENDIF
	ENDIF

	CALLFORM CARD_{カードID}, "속성"
	IF GETVAR(@"%듀얼리스트%_SS可속성番号:{RESULT}") == 0
		RETURN 1
	ENDIF



	IF GETVAR(@"%듀얼리스트%_속성制限") >= 1
		CALLFORM CARD_{カードID}, "속성"
		IF RESULT != GETVAR(@"%듀얼리스트%_속성制限")
			RETURN 1
		ENDIF
	ENDIF

	IF GETVAR(@"%듀얼리스트%_レベル５制限") >= 1
		CALLFORM CARD_{カードID}, "レベル"
		IF RESULT >= 5
			RETURN 1
		ENDIF
	ENDIF

	IF GETVAR(@"%듀얼리스트%_逆속성制限") >= 1
		CALLFORM CARD_{カードID}, "속성"
		IF RESULT == GETVAR(@"%듀얼리스트%_逆속성制限")
			RETURN 1
		ENDIF
	ENDIF


	CALLFORM CARD_{カードID}, "종족"
	IF GETVAR(@"%듀얼리스트%_SS可종족番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	IF GETVAR(@"%듀얼리스트%_종족制限") >= 1
		CALLFORM CARD_{カードID}, "종족"
		IF RESULT != GETVAR(@"%듀얼리스트%_종족制限")
			RETURN 1
		ENDIF
	ENDIF


	CALLFORM CARD_{カードID}, "종류"
	IF GETVAR(@"%듀얼리스트%_一時SS可종류番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "속성"
	IF GETVAR(@"%듀얼리스트%_一時SS可속성番号:{RESULT}") == 0
		RETURN 1
	ENDIF

	CALLFORM CARD_{カードID}, "종족"
	IF GETVAR(@"%듀얼리스트%_一時SS可종족番号:{RESULT}") == 0
		RETURN 1
	ENDIF



	CALLFORM CARD_{カードID}, "レベル"
	IF GETVAR(@"%듀얼리스트%_SS可レベル番号:{RESULT}") == 0
		RETURN 1
	ENDIF


	IF GETVARS(@"%듀얼리스트%_SS可カテゴリ") != ""
		CALLFORM CARDNAME_{カードID}, "カテゴリ"
		FOR カウンタB,0,5
			IF RESULTS:カウンタB != ""
				SIF RESULTS:カウンタB == GETVARS(@"%듀얼리스트%_SS可カテゴリ")
					条件달성 ++
			ENDIF
		NEXT
		IF 条件달성 == 0
			RETURN 1
		ENDIF
	ENDIF
ENDIF
RETURN 0

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;SS소환カード簿記
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;そのターンに특수 소환된 ード의 이력を보존する
;CARD_○○특수制限を確認
;@CARD_SS_CHECKのターン1、SS制限で判断

@CARD_SS_USE(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID

;발동효과
SELECTCASE 듀얼리스트
	CASE "자신"
		자신_SS済:자신_SS済カウンタ = カードID
		자신_SS済カウンタ ++
	CASE "상대"
		상대_SS済:상대_SS済カウンタ = カードID
		상대_SS済カウンタ ++
ENDSELECT

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;SS制限カード簿記
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;그 턴에 특수소환된 카드의 이력을 보존한다
;CARD_○○특수제한을 확인
;@CARD_SS_CHECK의 턴1、SS제한으로 판단

@CARD_ID_SS_RIST(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID

;발동효과
SELECTCASE 듀얼리스트
	CASE "자신"
		자신_ID制:자신_ID制カウンタ = カードID
		자신_ID制カウンタ ++
	CASE "상대"
		상대_ID制:상대_ID制カウンタ = カードID
		상대_ID制カウンタ ++
ENDSELECT


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;攻撃可否判断
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
;攻撃、通す場合はRETURN 0,불가能である場合はRETURN 1
@CARD_ATK_CHECK(듀얼리스트,場所)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB

#DIMS DYNAMIC 対面者
#DIM DYNAMIC 条件달성
#DIM DYNAMIC 単体攻撃中
#DIM DYNAMIC 攻撃誘導플래그
#DIM DYNAMIC 攻撃횟수
カードID = GETVAR(@"%듀얼리스트%_필드:場所")


CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

SIF ターン数 == 1
	RETURN 1
SIF ターンプレイヤー != 듀얼리스트
	RETURN 1
IF GETVAR(@"%듀얼리스트%_MZ_表:場所") != 1
	IF GETVAR(@"%듀얼리스트%_MZ_表:場所") == 2
		SIF GETVAR(@"%듀얼리스트%_MZ_守戦:場所") == 0
			RETURN 1
	ELSE
		RETURN 1
	ENDIF
ENDIF

IF GETVAR(@"%듀얼리스트%_MZ_追戦:場所") >= 1
	攻撃횟수 = GETVAR(@"%듀얼리스트%_MZ_追戦:場所") + GETVAR(@"%듀얼리스트%_MZ_戦:場所")
	SIF 攻撃횟수 <= 0
		RETURN 1
ELSE
	SIF GETVAR(@"%듀얼리스트%_MZ_戦:場所") <= 0
		RETURN 1
ENDIF
SIF GETVAR(@"%듀얼리스트%_MZ_戦無:場所") != 0
	RETURN 1

FOR カウンタ,0,5
	SIF GETVAR(@"%듀얼리스트%_필드:カウンタ") == -1
		CONTINUE
	SIF GETVAR(@"%듀얼리스트%_MZ_単攻:カウンタ") >= 1
		単体攻撃中 = 1
NEXT
SIF 単体攻撃中 == 1 && GETVAR(@"%듀얼리스트%_MZ_単攻:場所") == 0
	RETURN 1

FOR カウンタ,0,5
	SIF GETVAR(@"%対面者%_필드:カウンタ") == -1
		CONTINUE
	SIF GETVAR(@"%対面者%_MZ_攻誘:カウンタ") == 0
		CONTINUE
	攻撃誘導플래그 ++
NEXT
SIF 攻撃誘導플래그 == 2
	RETURN 1

SIF GETVAR(@"%듀얼리스트%_攻撃制限") >= 2
	RETURN 1

CALLFORM CARD_{カードID}, "종류"
IF GETVAR(@"%듀얼리스트%_攻撃可종류番号:{RESULT}") == 0
	;PRINTL 종류NG
	RETURN 1
ENDIF

CALLFORM CARD_{カードID}, "속성"
IF GETVAR(@"%듀얼리스트%_攻撃可속성番号:{RESULT}") == 0
	;PRINTL 속성NG
	RETURN 1
ENDIF

CALLFORM CARD_{カードID}, "종족"
IF GETVAR(@"%듀얼리스트%_攻撃可종족番号:{RESULT}") == 0
	;PRINTL 종족NG
	RETURN 1
ENDIF

IF GETVARS(@"%듀얼리스트%_攻撃可カテゴリ") != ""
	CALLFORM CARDNAME_{カードID}, "カテゴリ"
	FOR カウンタB,0,5
		IF RESULTS:カウンタB != ""
			SIF RESULTS:カウンタB == GETVARS(@"%듀얼리스트%_攻撃可カテゴリ")
				条件달성 ++
		ENDIF
	NEXT
	IF 条件달성 == 0
		RETURN 1
	ENDIF
ENDIF

RETURN 0

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@SPECIAL_EFFECT_RUN
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC 조교대상
#DIM DYNAMIC カウンタ

듀얼리스트 = 자신
REPEAT 2
	CALL 対面者판정(듀얼리스트)
	対面者 = %RESULTS%
	FOR カウンタ,0,5
		IF GETVAR(@"%듀얼리스트%_MZ_특수状態:カウンタ") <= 0
			CONTINUE
		ELSE 
			TRYCALLFORM CARDCAN_{GETVAR(@"%듀얼리스트%_MZ_특수状態:カウンタ")}(듀얼리스트,付与효과,"필드",カウンタ)
			SIF RESULT == 1
				CALLFORM CARDEFFECT_{GETVAR(@"%듀얼리스트%_MZ_특수状態:カウンタ")}(듀얼리스트,付与효과,"필드",カウンタ)
		ENDIF
	NEXT
듀얼리스트 = 상대
REND

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@ENSLAVE_RELEASE
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 대상エリア
#DIMS DYNAMIC 対面者
#DIM DYNAMIC 隷属先存在
#DIM DYNAMIC 爆破先存在

듀얼리스트 = %ターンプレイヤー%
CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

$INPUT_LOOP
FOR カウンタ,0,5
	IF GETVAR(@"%듀얼리스트%_MZ_束縛:カウンタ") <= -1
		CONTINUE
	ELSE 
		대상エリア = GETVAR(@"%듀얼리스트%_MZ_束縛:カウンタ")
		IF INRANGE(대상エリア,0,19)
			IF INRANGE(대상エリア,0,5)
				SIF GETVAR(@"%듀얼리스트%_필드:대상エリア") != -1
					隷属先存在 = 1
			ELSEIF INRANGE(대상エリア,10,15)
				대상エリア -= 10
				SIF GETVAR(@"%듀얼리스트%_마함:대상エリア") != -1
					隷属先存在 = 1	
			ENDIF

			IF 隷属先存在 == 0
				CALL FULLRESET
				CALL CARD_GET_CONTROL(듀얼리스트,カウンタ,0,1)
			ENDIF

		ELSEIF INRANGE(대상エリア,20,39)
			IF INRANGE(대상エリア,20,25)
				대상エリア -= 20
				SIF GETVAR(@"%듀얼리스트%_필드:대상エリア") != -1
					爆破先存在 = 1
			ELSEIF INRANGE(대상エリア,30,35)
				대상エリア -= 30
				SIF GETVAR(@"%듀얼리스트%_마함:대상エリア") != -1
					爆破先存在 = 1
			ENDIF
			IF 爆破先存在 == 0
				CALL FULLRESET
				CALL CARD_DISPOSE(듀얼리스트,"필드",カウンタ,絶対破壊行き)
			ENDIF
		ENDIF
	ENDIF
NEXT

IF 듀얼리스트 == ターンプレイヤー
	듀얼리스트 = %対面者%
	GOTO INPUT_LOOP
ENDIF


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CHECK_VICTORY

IF 자신_듀얼패배플래그 >= 1 || 상대_듀얼패배플래그 >= 1
	IF 자신_듀얼패배플래그 >= 1 && 상대_듀얼패배플래그 >= 1
		CALL CHARA_CUTIN("","【D R A W】")
		PRINTFORML 서로가 패배조건을 만족해버렸습니다。
		RETURN 3
	;ダメージによる패배
	ELSEIF 자신_듀얼패배플래그 == 1
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신의 라이프가 0이 되었습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 1
		IF ERA起動 == 2
			상대_듀얼패배플래그 = 0
			RETURN 0
		ENDIF
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대의 라이프를 0으로 만들었습니다。
		RETURN 1
	;덱0による패배
	ELSEIF 자신_듀얼패배플래그 == 2
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신은 카드를 뽑을수 없게 되었습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 2
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대는 카드를 뽑을수 없게 되었습니다。
		RETURN 1
	ELSEIF 자신_듀얼패배플래그 == 3
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신은 항복을 골랐습니다。
		RETURN 2
	ELSEIF 자신_듀얼패배플래그 == 4
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신은 게임의 속행이 불가능해졌습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 4
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대는 게임의 속행이 불가능해졌습니다。
		RETURN 1

	ELSEIF 자신_듀얼패배플래그 == 5
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 상대의 패에 엑조디아가 모였습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 5
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 자신의 패에 엑조디아가 모였습니다。
		RETURN 1
	ELSEIF 자신_듀얼패배플래그 == 6
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 상대의 고스트릭의 타천사의 X소재가１０개를 넘었습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 6
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 자신의 고스트릭의 타천사의 X소재가１０개를 넘었습니다。
		RETURN 1

	ELSEIF 자신_듀얼패배플래그 == 7
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신의 패배까지의 카운트다운이 ０이 되었습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 7
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대의 패배까지의 카운트다운이 ０이 되었습니다。
		RETURN 1

	ELSEIF 자신_듀얼패배플래그 == 9
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML K N D N
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 9
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML K N D N
		RETURN 1


	ELSEIF 자신_듀얼패배플래그 == 10
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 상대는 웜에게 모든걸 삼켜져버렸습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 == 10
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대는 웜에게 모든걸 삼켜져버렸습니다。
		RETURN 1

	ELSEIF 상대_듀얼패배플래그 == 999
		CALL CHARA_CUTIN("", "【W I N N E R】")
		IF 詰め플래그 == 1
			PRINTFORML 퍼즐을 달성했습니다。
		ELSE
			PRINTFORML 디버그데이스
		ENDIF
		RETURN 1
	ELSEIF 자신_듀얼패배플래그 >= 1
		CALL CHARA_CUTIN("", "【L O S E】")
		PRINTFORML 자신은 패배조건을 만족했습니다。
		RETURN 2
	ELSEIF 상대_듀얼패배플래그 >= 1
		CALL CHARA_CUTIN("", "【W I N N E R】")
		PRINTFORML 상대는 패배조건을 만족했습니다。
		RETURN 1


	ENDIF
ENDIF
RETURN 0

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARDDRAW_BASIC(듀얼리스트,ドロー枚数,うらら불가)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC ドロー枚数
#DIM DYNAMIC うらら불가
#DIM DYNAMIC 選択カード_ID

CUSTOMDRAWLINE —
PRINTL 【카드 드로우 처리】
CUSTOMDRAWLINE —
PRINTL 

SIF ドロー枚数 <= 0
	RETURN 0

IF GETVAR(@"%듀얼리스트%_ドロー불가") >= 1 && うらら불가 != 1
	PRINTFORMW 드로우 할 수 없습니다。
	RETURN 0
ENDIF


IF ドロー枚数 > 現山札数(듀얼리스트)
	IF 듀얼리스트 == "자신"
		ALIGNMENT CENTER
		SETCOLOR C_RED
		CUSTOMDRAWLINE ＼
		CUSTOMDRAWLINE ／
		PRINTFORMW L I B R A R Y  O U T
		CUSTOMDRAWLINE ＼
		CUSTOMDRAWLINE ／
		RESETCOLOR
		자신_듀얼패배플래그 = 2
	ELSE
		ALIGNMENT CENTER
		SETCOLOR C_RED
		CUSTOMDRAWLINE ＼
		CUSTOMDRAWLINE ／
		PRINTFORMW L I B R A R Y  O U T
		CUSTOMDRAWLINE ＼
		CUSTOMDRAWLINE ／
		RESETCOLOR
		상대_듀얼패배플래그 = 2
	ENDIF
	ALIGNMENT LEFT
	RETURN 0
ENDIF

VARSET RESULT
IF うらら불가 == 0
	CALL URARA_CHANCE(듀얼리스트,処理中_효과ID,"雑多")
ENDIF
IF RESULT == 1
	CALL SHUFFLE(듀얼리스트)
	RETURN 0
ELSE
	REPEAT ドロー枚数
		VARSET 選択カード_ID
		選択カード_ID = GETVAR(@"%듀얼리스트%_덱:0")
		CALL CHECK_CARDDRAW_ID(듀얼리스트,選択カード_ID)
		IF RESULT == 1
			CALL CARD_DISPOSE(듀얼리스트,"덱",0,破壊行き)
			RETURN 0
		ENDIF
		CALL CARD_FIN_ID_SET(듀얼리스트,選択カード_ID,"Ｃドロー")

		CALL CARD_ADD(듀얼리스트, "덱", "손패", 0,"ドロー")
		SETVAR @"%듀얼리스트%_手加数" , GETVAR(@"%듀얼리스트%_手加数") + 1
	REND
ENDIF


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
@CHECK_CARDDRAW_ID(듀얼리스트,選択カード_ID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 選択カード_ID


IF GETVAR(@"%듀얼리스트%_上モンウイルス") >= 1
	TRYCALLFORM CARD_{選択カード_ID}("攻撃力")
	SIF RESULT >= 1500
		RETURN 1
ELSEIF GETVAR(@"%듀얼리스트%_下モンウイルス") >= 1
	TRYCALLFORM CARD_{選択カード_ID}("攻撃力")
	SIF RESULT <= 1500
		RETURN 1
ELSEIF GETVAR(@"%듀얼리스트%_魔ウイルス") >= 1
	TRYCALLFORM CARD_{選択カード_ID}("종류")
	SIF INRANGE(RESULT,20,30)
		RETURN 1
ELSEIF GETVAR(@"%듀얼리스트%_함정ウイルス") >= 1
	TRYCALLFORM CARD_{選択カード_ID}("종류")
	SIF RESULT >= 함정全般
		RETURN 1
ENDIF
RETURN 0

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_SETCOLOR(듀얼리스트,参照先,場所,裏側플래그,明度ダウン)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 参照先
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 덱内枚数
#DIM DYNAMIC 明度ダウン
#DIM DYNAMIC 문자색설정
#DIM DYNAMIC 裏側플래그
#DIM 同名カード枚数
#DIM 現在カードID

カードID = GETVAR(@"%듀얼리스트%_%参照先%:{場所}")
SIF カードID <= 0
	RETURN 0


TRYCALLFORM CARD_{カードID}, "종류"

IF RESULT == 0
	RESETCOLOR
ELSEIF 裏側플래그 >= 3
	SETCOLOR C_L_GRAY
ELSEIF RESULT <= 10
	IF RESULT == 1
		SETCOLOR C_MONS_BR
	ELSEIF RESULT == 2
		SETCOLOR C_BASM_BR
	ELSEIF RESULT == 의식
		SETCOLOR C_GISK_BLUE
	ELSEIF RESULT == 융합
		SETCOLOR C_FUSE_PUR
	ELSEIF RESULT == 싱크로
		SETCOLOR C_SYN_WHITE
	ELSEIF RESULT == 엑시즈
		SETCOLOR C_XYZ_BLACK
	ELSEIF RESULT == 링크
		SETCOLOR C_LINK_BLUE
	ELSEIF RESULT == 초차원
		SETCOLOR C_PSY_RED
	ENDIF
ELSEIF RESULT >= 20 && RESULT < 30
	SETCOLOR C_MAGIC_G
ELSEIF RESULT >= 30
	SETCOLOR C_TRAP_PUR
ENDIF
IF 明度ダウン == 1
	문자색설정 = GETCOLOR()
	SETCOLOR 明度변경(80, 문자색설정)
ENDIF
IF 듀얼리스트 == "編集"
	IF 場所 == 0
		VARSET 同名カード枚数
		VARSET 現在カードID
	ENDIF
	IF 現在カードID != カードID
		現在カードID = カードID
		VARSET 同名カード枚数
	ELSE
		同名カード枚数 ++
	ENDIF
	IF ITEM:カードID == 0
		SETCOLOR C_GRAY
	ENDIF
	IF ITEM:カードID < 同名カード枚数 + 1
		SETCOLOR C_GRAY
	ENDIF
ENDIF
IF 듀얼리스트 == "컬렉션" || 듀얼리스트 == "EX컬렉션"
	IF ITEM:カードID == 0
		SETCOLOR C_GRAY
	ENDIF
ENDIF


;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――


@CARD_SUMMON_SHORI(듀얼리스트,選択カード,표시形式,효과소환플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 표시形式
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 選択カード
#DIM DYNAMIC カードレベル
#DIM DYNAMIC 소환カード_ID
#DIM DYNAMIC 묘지送カード,5
#DIM DYNAMIC 효과소환플래그
#DIM DYNAMIC 現在最小攻撃力

VARSET 묘지送カード, -1
IF 소환権 == 0 && 효과소환플래그 == 0
	PRINTW 소환권이 없습니다。
	RETURN 0
ENDIF


소환カード_ID = GETVAR(@"%듀얼리스트%_손패:選択カード")



;소환한 いカードの레벨을 確認する：
TRYCALLFORM CARD_{소환カード_ID}("レベル")
カードレベル = RESULT
SIF GETVAR(@"%듀얼리스트%_手_一星:選択カード") >= 1
	カードレベル -= GETVAR(@"%듀얼리스트%_手_一星:選択カード")
SIF カードレベル <= 1
	カードレベル = 1
;PRINTFORML 소환몬스터의 レベル：{カードレベル} / GETVAR:{GETVAR(@"%듀얼리스트%_手_一星:選択カード")}
;4以下はリリース必要なし
IF カードレベル <= 4 || 효과소환플래그 == 1 || 효과소환플래그 == 2 || 효과소환플래그 == 4
	PRINTFORMW 통상소환！
	;소환処理
	IF 효과소환플래그 == 2 || 효과소환플래그 == 4
		CALLFORM CARDEFFECT_{소환カード_ID}(듀얼리스트,효과소환,"손패",選択カード)
		IF RESULT != 1
			RETURN 0
		ENDIF
	ENDIF
	IF モンスター数(듀얼리스트) == 5
		PRINTFORMW 몬스터 존이 가득차서 소환할 수 없습니다。
		RETURN 0
	ENDIF
	IF 표시形式 == "攻撃표시"
		CALL CARD_SUMMON(듀얼리스트, 選択カード)
	ELSE
		CALL CARD_SUMMON(듀얼리스트, 選択カード,"裏側표시")
	ENDIF
	CALL CARD_FINAL(ターンプレイヤー);通常소환後のチェック
	;소환演出
	TRYCALLFORM CARDSUMMON_AA_{소환カード_ID}
	IF 효과소환플래그 != 1	
		IF (효과소환플래그 == 3 || 효과소환플래그 == 4) && 追소환権 >= 1
			追소환権 -= 1
		ELSE
			소환権 -= 1
		ENDIF
	ENDIF
	RETURN 1
;5以上はリリース必要、正直今時最上級で2リリース必要なのバグだと思うのでそれらも1枚だけ
ELSEIF INRANGE(カードレベル,5,6) 
	CALL FULLRESET
	효과条件任意 = 1
	CALL CARD_ADD_GY_BASIC(듀얼리스트,"필드","특수")
	IF RESULT == 1
		TRYCALLFORM CARDSUMMON_AA_{소환カード_ID}
		IF 표시形式 == "攻撃표시"
			CALL CARD_SUMMON(듀얼리스트, 選択カード)
		ELSE
			CALL CARD_SUMMON(듀얼리스트, 選択カード,"裏側표시")
		ENDIF
		IF (효과소환플래그 == 3 || 효과소환플래그 == 4) && 追소환権 >= 1
			追소환権 -= 1
		ELSE
			소환権 -= 1
		ENDIF
		CALL CARD_FINAL(ターンプレイヤー);上級소환後のチェック
		RETURN 1
	ELSE
		PRINTFORMW 돌아갑니다。
		RETURN 0
	ENDIF
ELSEIF INRANGE(カードレベル,7,12) 
	CALL FULLRESET
	효과条件任意 = 1
	효과条件複数 = 2
	CALL CARD_ADD_GY_BASIC(듀얼리스트,"필드","특수")
	IF RESULT == 1
		TRYCALLFORM CARDSUMMON_AA_{소환カード_ID}
		IF 표시形式 == "攻撃표시"
			CALL CARD_SUMMON(듀얼리스트, 選択カード)
		ELSE
			CALL CARD_SUMMON(듀얼리스트, 選択カード,"裏側표시")
		ENDIF
		IF (효과소환플래그 == 3 || 효과소환플래그 == 4) && 追소환権 >= 1
			追소환権 -= 1
		ELSE
			소환権 -= 1
		ENDIF
		CALL CARD_FINAL(ターンプレイヤー);最上級소환後のチェック
		RETURN 1
	ELSE
		PRINTFORMW 돌아갑니다。
		RETURN 0
	ENDIF
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@TEXT_DECORATION(デコレーション)
#DIMS DYNAMIC デコレーション
SIF 検索플래그 == 1
	RETURN 0

ALIGNMENT CENTER
SELECTCASE デコレーション
	;1行の最大値は153
	CASE "ROGUE"
		SETCOLOR C_RED
		PRINTL ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD ROGUE CARD
		RESETCOLOR
	CASE "P_MAGIC"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 34% PENDULUM  MAGIC %"―" * 34%

		PRINTFORML %"―" * 29%이 카드는 지속마법 취급으로 발동할 수 있다 %"―" * 29%

		RESETCOLOR
	CASE "P_MAGIC_2","D_HEART_2"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 24%이 카드는 필드 에서묘지로 보내졌을 경우 EX덱으로 간다%"―" * 23%
		PRINTFORML %"―" * 34% 몬스터 효과 %"―" * 34%
		RESETCOLOR
	CASE "MAXIMUM"
		SETCOLOR C_GOLD
		PRINTFORML %"―" * 33%【맥시멈모드】%"―" * 33%
		PRINTFORML %"―" * 22%모든 파츠가 모여있는 맥시멈 몬스터는 완전내성을 갖는다%"―" * 22%
		RESETCOLOR

	CASE "D_HEART_W"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 33% DRAG-HEART WEAPON %"―" * 33%

		RESETCOLOR

	CASE "D_HEART_F"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 34% DRAG-HEART FORT %"―" * 34%
		RESETCOLOR

	CASE "D_HEART_C"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 32% DRAG-HEART CREATURE %"―" * 32%
		RESETCOLOR


	CASE "IMPACT!"
		SETCOLOR C_MAGIC_G
		PRINTFORML %"―" * 35% FINISHER MOVE %"―" * 35%
		RESETCOLOR
	CASE "CUSTOM"
		SETCOLOR C_YELLOW
		PRINTFORML %"―" * 34%커스텀 카드%"―" * 34%
		RESETCOLOR


	CASE "INVASION"
		SETCOLOR C_RED
		PRINTL ――――――//////――――――――――――――――――――――////// 침　략 //////――――――――――――――――――――――――//////――――――
		RESETCOLOR
	CASE "SUBST"
		SETCOLOR C_YELLOW
		PRINTFORML %"―" * 37% 가설치 % "―" * 37%
		PRINTFORML %"―" * 34%효과는 없습니다%"―" * 34%
		RESETCOLOR
	CASE "TEST"
		SETCOLOR C_YELLOW
		PRINTFORML %"―" * 37%　TEST　% "―" * 37%
		PRINTL ―――――――――――――― 테스트 실장、동작문제 없음/버그발생했을 경우엔 보고부탁드립니다――――――――――――――
		RESETCOLOR
	CASE "DUELIST"
		SETCOLOR C_YELLOW
		PRINTFORML %"―" * 35% 듀얼리스트 % "―" * 35%
		RESETCOLOR
		
	CASE "LASTWORD"
		SETCOLOR C_YELLOW
		PRINTFORML %"―" * 33% LAST WORD % "―" * 33%
		RESETCOLOR

ENDSELECT
ALIGNMENT LEFT
;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_GRANT_SPECIAL(듀얼리스트,場所,付与ID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIM DYNAMIC 付与ID
#DIM DYNAMIC 場所

IF GETVAR(@"%듀얼리스트%_MZ_특수状態:場所") <= 0
	SETVAR @"%듀얼리스트%_MZ_특수状態:場所", 付与ID
ENDIF

;――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARD_EFFECT_CHECK(듀얼리스트,場所,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIM DYNAMIC カードID
#DIM DYNAMIC 場所
#DIM DYNAMIC 耐性衝突

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

TRYCALLFORM CARD_{カードID}, "종류"
IF GETVAR(@"%듀얼리스트%_MZ_モ耐:場所") >= 1 && INRANGE(RESULT, 0,15)
	耐性衝突 = 1
ELSEIF GETVAR(@"%듀얼리스트%_MZ_魔耐:場所") >= 1 && INRANGE(RESULT, 20,30)
	耐性衝突 = 1
ELSEIF GETVAR(@"%듀얼리스트%_MZ_함정耐:場所") >= 1 && INRANGE(RESULT, 30,40)
	耐性衝突 = 1
ENDIF

IF 耐性衝突 == 1
	SETCOLOR C_RED
	CUSTOMDRAWLINE —
	PRINTL
	PRINTL ＊카드의 효과가 내성에 막혔다！
	PRINTL
	CUSTOMDRAWLINE —
	RESETCOLOR
	PRINTW
	RETURN 0
ELSE
	RETURN 1
ENDIF







@SET_FIELD_INFO(듀얼리스트,ゾーン,場所,효과種,효과修正,설정타입,反転플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 実行者
#DIM DYNAMIC 反転플래그
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 場所
#DIMS DYNAMIC 효과種
#DIM DYNAMIC 효과修正
#DIM DYNAMIC 설정타입
#DIM DYNAMIC カードID
#DIM DYNAMIC LRESULT

LRESULT = RESULT

SIF 場所 == 5
	RETURN 0

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF 反転플래그 == 0
	実行者 = %듀얼리스트%
ELSE
	実行者 = %対面者%
ENDIF

カードID = GETVAR(@"%実行者%_%ゾーン%:場所")


IF ゾーン == "필드"
	ゾーン = MZ
ELSEIF ゾーン == "마함"
	ゾーン = 魔
ENDIF

IF 설정타입 == 上書きモード
	IF 효과種 == "表"
		IF GETVAR(@"%実行者%_%ゾーン%_%효과種%:場所") != 효과修正 && 효과修正 != 3
			CALLFORM CARD_STANBY(カードID,実行者,표시변경誘発,"필드",場所)
		ENDIF
		IF GETVAR(@"%実行者%_%ゾーン%_%효과種%:場所") == 3 && 효과修正 != 3
			CALLFORM CARD_STANBY(カードID,実行者,リバース誘発,"필드",場所)
		ENDIF
	ELSEIF 효과種 == "装"
		SETVAR @"%듀얼리스트%_装備成功_保", 1
	ENDIF
	SETVAR @"%実行者%_%ゾーン%_%효과種%:場所", 효과修正
ELSE
	IF 효과種 == "一星" || 효과種 == "永星"
		SETVAR @"%実行者%_%ゾーン%_%효과種%:場所",GETVAR(@"%実行者%_MZ_星:場所") + 효과修正
	ELSE
		SETVAR @"%実行者%_%ゾーン%_%효과種%:場所", GETVAR(@"%実行者%_%ゾーン%_%효과種%:場所") + 효과修正
	ENDIF
ENDIF




RETURN LRESULT


@SET_PLAYER_INFO(듀얼리스트,효과種,효과修正,反転플래그,설정타입)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 효과種
#DIM DYNAMIC 효과修正
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 설정타입
#DIMS DYNAMIC 대상名

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF 反転플래그 == 0
	대상名 = %듀얼리스트%
ELSEIF 反転플래그 == 1
	대상名 = %対面者%
ELSEIF 反転플래그 == 2
	대상名 = お互い
ENDIF


IF 설정타입 == 0
	IF 反転플래그 == 0
		IF 효과種 == "超속성효과無効"
			SELECTCASE 효과修正
			;パージ
			CASE 1
				SETVAR @"%듀얼리스트%_어둠속성효과無効", 2
				SETVAR @"%듀얼리스트%_물속성효과無効", 2
				SETVAR @"%듀얼리스트%_화염속성효과無効", 2
				PRINTFORMW %대상名%に『어둠물화염속성효과무효』가 적용되었습니다。
				RETURN 1
			;インパルス
			CASE 2
				SETVAR @"%듀얼리스트%_빛속성효과無効", 2
				SETVAR @"%듀얼리스트%_땅속성효과無効", 2
				SETVAR @"%듀얼리스트%_바람속성효과無効", 2
				PRINTFORMW %대상名%に『빛땅바람속성효과무효』가 적용되었습니다。
				RETURN 1
			;デドダム
			CASE 10
				SETVAR @"%듀얼리스트%_빛속성효과無効", 2
				SETVAR @"%듀얼리스트%_화염속성효과無効", 2
				SETVAR @"%듀얼리스트%_땅속성효과無効", 2
				PRINTFORMW %대상名%に『빛화염땅속성효과무효』가 적용되었습니다。
				RETURN 1
			ENDSELECT
		ELSE
			SETVAR @"%듀얼리스트%_%효과種%", 효과修正
		ENDIF
	ELSEIF 反転플래그 == 1
		SETVAR @"%対面者%_%효과種%", 효과修正
	ELSEIF 反転플래그 == 2
		SETVAR @"%듀얼리스트%_%효과種%", 효과修正
		SETVAR @"%対面者%_%효과種%", 효과修正
	ENDIF

	SIF 효과修正 != 3
		PRINTFORMW %대상名%に『%효과種%』가 적용되었습니다。

ELSEIF 설정타입 == 1
	IF 反転플래그 == 0
		SETVAR @"%듀얼리스트%_%효과種%", GETVAR(@"%듀얼리스트%_%효과種%") + 효과修正
	ELSEIF 反転플래그 == 1
		SETVAR @"%対面者%_%효과種%", GETVAR(@"%対面者%_%효과種%") + 효과修正
	ELSEIF 反転플래그 == 2
		SETVAR @"%듀얼리스트%_%효과種%", GETVAR(@"%듀얼리스트%_%효과種%") + 효과修正
		SETVAR @"%対面者%_%효과種%", GETVAR(@"%対面者%_%효과種%") + 효과修正
	ENDIF
	PRINTFORMW %대상名%의『%효과種%』가 １개 늘었습니다。
ENDIF

@GET_PLAYER_INFO(듀얼리스트,효과種,反転플래그)
#FUNCTION
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 효과種
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 返し値

IF 反転플래그 == 1
	IF 듀얼리스트 == "자신"
		듀얼리스트 = 상대
	ELSE
		듀얼리스트 = 자신
	ENDIF
ENDIF
IF 효과種 == "K9발동数"
	返し値 += GETVAR(@"%듀얼리스트%_묘지발동数") + GETVAR(@"%듀얼리스트%_손패발동数")
ELSE
	返し値 += GETVAR(@"%듀얼리스트%_%효과種%")
ENDIF

IF 反転플래그 == 2
	IF 듀얼리스트 == "자신"
		듀얼리스트 = 상대
	ELSE
		듀얼리스트 = 자신
	ENDIF
	返し値 += GETVAR(@"%듀얼리스트%_%효과種%")
ENDIF
RETURNF 返し値



@SET_TMP_EX_RST(듀얼리스트,SS종류,효과종류,反転플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC SS종류
#DIM DYNAMIC 효과종류
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 설정타입
#DIM DYNAMIC カウンタ
CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

SELECTCASE SS종류
CASE "종족"
	FOR カウンタ,0,20
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時EX可종족番号:{カウンタ}", 0
	NEXT
CASE "종류"
	FOR カウンタ,0,20
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時EX可종류番号:{カウンタ}", 0
	NEXT
CASE "속성"
	FOR カウンタ,0,10
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時EX可속성番号:{カウンタ}", 0
	NEXT
CASE "全般"
	SETVAR @"%듀얼리스트%_一時EX制限", 1
ENDSELECT


@SET_TMP_SS_RST(듀얼리스트,SS종류,효과종류,反転플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC SS종류
#DIM DYNAMIC 효과종류
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 설정타입
#DIM DYNAMIC カウンタ
CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

SELECTCASE SS종류
CASE "종족"
	FOR カウンタ,0,20
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時SS可종족番号:{カウンタ}", 0
	NEXT
CASE "종류"
	FOR カウンタ,0,20
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時SS可종류番号:{カウンタ}", 0
	NEXT
CASE "속성"
	FOR カウンタ,0,10
		SIF 효과종류 == カウンタ
			CONTINUE
		SETVAR @"%듀얼리스트%_一時SS可속성番号:{カウンタ}", 0
	NEXT


CASE "全般"
	SETVAR @"%듀얼리스트%_一時SS制限", 0
ENDSELECT


@SET_CAT_SOGAI_INFO(듀얼리스트,カテゴリ名)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 효과種
#DIMS DYNAMIC カテゴリ名
#DIM DYNAMIC 설정타입

SETVAR @"%듀얼리스트%_カテ阻害", カテゴリ名

@SET_FIELD_MAGIC_INFO(듀얼리스트,フィールド名,反転플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 효과種
#DIMS DYNAMIC フィールド名
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 설정타입

SETVAR @"%듀얼리스트%_フィールド名", フィールド名

@GET_FIELD_MAGIC_INFO(듀얼리스트,フィールド名,反転플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 효과種
#DIMS DYNAMIC フィールド名
#DIM DYNAMIC 反転플래그
#DIM DYNAMIC 설정타입

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%


IF 反転플래그 == 1
	SIF GETVARS(@"%対面者%_フィールド名") == フィールド名
		RETURN 1
ELSEIF 反転플래그 == 2
	SIF GETVARS(@"%듀얼리스트%_フィールド名") == フィールド名
		RETURN 1
	SIF GETVARS(@"%対面者%_フィールド名") == フィールド名
		RETURN 1
ELSE
	SIF GETVARS(@"%듀얼리스트%_フィールド名") == フィールド名
		RETURN 1
ENDIF
RETURN 0

@CHECK_DP_GET(勝利판정,이벤트플래그)
#DIM DYNAMIC 勝利판정
#DIM DYNAMIC 획득DP
#DIM DYNAMIC 이벤트플래그
RESETBGCOLOR
FONTSTYLE 8
PRINTFORML 결과：

IF 자신_듀얼패배플래그 >= 1
	IF 자신_듀얼패배플래그 == 3
		획득DP += 10
		PRINTFORML %"듀얼 항복",30,LEFT%: +10
		GOTO SKIP_RESULT
	ELSE
		획득DP += 100
		PRINTFORML %"듀얼 패배",30,LEFT%: + 100
		FLAG:듀얼보너스 += 1
	ENDIF
ENDIF

IF 상대_듀얼패배플래그 >= 1
	IF 상대_듀얼패배플래그 == 1
		획득DP += 1000
		PRINTFORML %"듀얼 승리",30,LEFT%: +1000
	ELSEIF 상대_듀얼패배플래그 == 2
		획득DP += 1500
		PRINTFORML %"듀얼 승리(특수)",30,LEFT%: +1500
	ELSEIF 상대_듀얼패배플래그 == 3
		획득DP += 900
		PRINTFORML %"듀얼 승리(항복)",30,LEFT%: +900
	ELSEIF 상대_듀얼패배플래그 == 4
		획득DP += 500
		PRINTFORML %"듀얼 승리(기절)",30,LEFT%: +500
	ELSEIF 상대_듀얼패배플래그 >= 5
		획득DP += 1500
		PRINTFORML %"듀얼 승리(특수)",30,LEFT%: +1500
	ENDIF
	IF リザルト：後攻 == 1
		획득DP += 400
		PRINTFORML %"후공승리",30,LEFT%: +400
	ENDIF
	IF リザルト：ノーダメ == 1
		획득DP += 500
		PRINTFORML %"노 데미지",30,LEFT%: +500
	ENDIF
	FLAG:듀얼보너스 += 5
ENDIF

IF ターン数 >= 2
	획득DP += 20 * (ターン数 - 1)
	PRINTFORML %"턴 수 보너스",30,LEFT%: +{20 * (ターン数 - 1)}
ENDIF

IF ターン数 == 1
	획득DP += 500
	PRINTFORML %"ONE TURN KILL",30,LEFT%: + 500
ENDIF


IF リザルト：FUS소환 == 1
	획득DP += 200
	PRINTFORML %"융합소환",30,LEFT%: +200
ENDIF
IF リザルト：RIT소환 == 1
	획득DP += 200
	PRINTFORML %"의식소환",30,LEFT%: +200
ENDIF
IF リザルト：SYN소환 == 1
	획득DP += 200
	PRINTFORML %"싱크로소환",30,LEFT%: +200
ENDIF
IF リザルト：XYZ소환 == 1
	획득DP += 200
	PRINTFORML %"엑시즈소환",30,LEFT%: +200
ENDIF

IF リザルト：LIN소환 == 1
	획득DP += 200
	PRINTFORML %"링크소환",30,LEFT%: +200
ENDIF
IF リザルト：함정발동 == 1
	획득DP += 50
	PRINTFORML %"함정발동",30,LEFT%: +50
ENDIF

IF リザルト：마법발동 == 1
	획득DP += 50
	PRINTFORML %"마법발동",30,LEFT%: +50
ENDIF

IF 이벤트플래그 == 2
	TIMES 획득DP,0.10
	PRINTFORML %"연습시합",30,LEFT%: /10
ENDIF

$SKIP_RESULT
FONTSTYLE 0
PRINTL
PRINTL
PRINTFORML %"획득DP",30,LEFT%: +{획득DP}
CUSTOMDRAWLINE —
FLAG:듀얼포인트 += 획득DP
SIF TARGET >= 1
	TFLAG:97 += 획득DP / 30
PRINTFORML 합계DP:{FLAG:듀얼포인트}


IF 상대_듀얼패배플래그 >= 1
	レート増減 = (획득DP / 100)
	;Anonym추가
	IF オンラインレート < 100
		レート増減 *= 5
	ELSEIF INRANGE(オンラインレート,100,199)
		レート増減 *= 4
	ELSEIF INRANGE(オンラインレート,200,299)
		レート増減 *= 3
	ELSEIF INRANGE(オンラインレート,300,399)
		レート増減 *= 2
	ENDIF
ELSEIF 자신_듀얼패배플래그 >= 1
	レート増減 = 8 + (オンラインレート / 1000 * 3)
ENDIF


CUSTOMDRAWLINE —

EXP:MASTER:듀얼경험 ++
SIF TARGET >= 1
	EXP:TARGET:듀얼경험 ++
RETURN 획득DP


@DUEL_RESULT_BOND(選択덱,획득DP)
#DIM DYNAMIC 選択덱
#DIM DYNAMIC 획득DP
#DIM DYNAMIC 획득호감도
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB
#DIM DYNAMIC 캐릭터_ID
#DIM DYNAMIC カード_ID
;#DIM DYNAMIC 投入보존,紙束最大値
;#DIM DYNAMIC 同名カウント,紙束最大値

#DIM DYNAMIC 캐릭터보존,1000
#DIM DYNAMIC 캐릭터호감도,1000
;#DIM DYNAMIC 캐릭터枚数,1000
#DIM DYNAMIC 캐릭터カウント
;#DIM DYNAMIC 制限플래그
;#DIM DYNAMIC 準制限플래그
;#DIM DYNAMIC アイドル플래그
;#DIM DYNAMIC エース플래그
;#DIM DYNAMIC 切り札플래그
#DIM DYNAMIC 枚数カウント
#DIM DYNAMIC 호감도キャップ
#DIM CONST 호감도キャップ算出用 = 1500, 3000, 5000, 10000, 30000, 60000, 1000000


SIF 選択덱 > 30
	RETURN 0

;まずは호감도上がる캐릭터クターのIDを보존する――――――――――――――――――――
;보존되어있는 캐릭터IDは弾く설정に。
FOR	カウンタ,0,紙束最大値
	SIF 마이덱:選択덱:カウンタ == -1
		CONTINUE
	カード_ID = マイEX덱:選択덱:カウンタ
	CALL CARD_EROTICS(마이덱:選択덱:カウンタ,,1)
	캐릭터_ID = RESULT
	SIF 캐릭터_ID <= 0
		CONTINUE
	SIF MATCH(캐릭터보존,캐릭터_ID)
		CONTINUE
	캐릭터보존:캐릭터カウント = 캐릭터_ID
	캐릭터カウント ++
NEXT

FOR	カウンタ,0,紙束最大値
	SIF マイEX덱:選択덱:カウンタ == -1
		CONTINUE
	カード_ID = マイEX덱:選択덱:カウンタ
	CALL CARD_EROTICS(マイEX덱:選択덱:カウンタ,,1)
	캐릭터_ID = RESULT
	SIF 캐릭터_ID <= 0
		CONTINUE
	SIF MATCH(캐릭터보존,캐릭터_ID)
		CONTINUE
	캐릭터보존:캐릭터カウント = 캐릭터_ID
	캐릭터カウント ++
NEXT

;캐릭터クターの基礎호감도を보존する：基本は枚数×획득호감도――――――――――――――――――――
FOR カウンタ,0,캐릭터カウント
	캐릭터_ID = 캐릭터보존:カウンタ
	枚数カウント = 0
	FOR カウンタB,0,紙束最大値
		カード_ID = 마이덱:選択덱:カウンタB
		CALL CARD_EROTICS(カード_ID,,1)
		IF 캐릭터_ID == RESULT
			IF ITEM:69 >= 1
				획득호감도 = (획득DP / 10)
			ELSE
				획득호감도 = (획득DP / 30)
			ENDIF
			CALL CARD_RESTRICTION_CHECK(カード_ID)
			;制限カードだった場合
			SIF RESULT == 1
				TIMES 획득호감도, 1.3
			;準制限カードだった場合
			SIF RESULT == 2
				TIMES 획득호감도, 1.1
			SIF カード_ID == 자신_アイドル 
				TIMES 획득호감도, 1.5
			SIF カード_ID == 자신_エース 
				TIMES 획득호감도, 1.2
			SIF カード_ID == 자신_切り札
				TIMES 획득호감도, 1.3
			캐릭터호감도:カウンタ += 획득호감도
			枚数カウント ++
		ENDIF
	NEXT
	FOR カウンタB,0,紙束最大値
		カード_ID = マイEX덱:選択덱:カウンタB
		CALL CARD_EROTICS(カード_ID,,1)
		IF 캐릭터_ID == RESULT
			IF ITEM:69 >= 1
				획득호감도 = (획득DP / 10)
			ELSE
				획득호감도 = (획득DP / 30)
			ENDIF
			CALL CARD_RESTRICTION_CHECK(カード_ID)
			;制限カードだった場合
			SIF RESULT == 1
				TIMES 획득호감도, 1.3
			;準制限カードだった場合
			SIF RESULT == 2
				TIMES 획득호감도, 1.1
			SIF カード_ID == 자신_アイドル 
				TIMES 획득호감도, 1.5
			SIF カード_ID == 자신_エース 
				TIMES 획득호감도, 1.2
			SIF カード_ID == 자신_切り札
				TIMES 획득호감도, 1.3
			캐릭터호감도:カウンタ += 획득호감도
			枚数カウント ++
		ENDIF
	NEXT
	;投入枚数が3장을 越えている場合は보정をかける（0にはならない）
	SIF 캐릭터호감도:カウンタ > 0 && 枚数カウント > 3
		캐릭터호감도:カウンタ = MAX(캐릭터호감도:カウンタ * 7 / SQRT(16 * 枚数カウント), 1)
NEXT

;各種보너스を보존する――――――――――――――――――――
SIF 캐릭터カウント
	PRINTFORML %NAME:MASTER%의 덱에 들어간 정령들은%NAME:MASTER%을 보다 신뢰하게 된것같다。
FOR カウンタ,0,캐릭터カウント
	캐릭터_ID = 캐릭터보존:カウンタ

	;ABL:친밀と호감도ランクによってキャップがかかる
	;普通の子はデュエルで使うだけで恋に落ちてはくれません。ちょっとは대화したりしましょう
	IF 캐릭터호감도:カウンタ > 0 && ABL:캐릭터_ID:친밀 < 10
		호감도キャップ = 호감도キャップ算出用:LIMIT(ABL:캐릭터_ID:친밀 - CSVABL(NO:캐릭터_ID, GETNUM(ABL, "친밀")) + (TALENT:캐릭터_ID:즉시타락 * 2), 0, 6)
		SIF CFLAG:캐릭터_ID:호감도 + 캐릭터호감도:カウンタ >= 호감도キャップ
			캐릭터호감도:カウンタ = MAX(캐릭터호감도:カウンタ / 20, 호감도キャップ - CFLAG:캐릭터_ID:호감도, 1)
	ENDIF

	CFLAG:캐릭터_ID:호감도 += 캐릭터호감도:カウンタ
	CFLAG:캐릭터_ID:호감도 = LIMIT(CFLAG:캐릭터_ID:호감도, 0, 999999)
	SETCOLOR C_PINK
	PRINTFORML %NAME:캐릭터_ID,30,LEFT% 호감도 + {캐릭터호감도:カウンタ}
	RESETCOLOR
NEXT




CUSTOMDRAWLINE —


@DICE_ROLL(듀얼리스트,ダイス数)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC ダイス数
#DIM DYNAMIC ダイス結果
#DIM DYNAMIC ダイス合計
#DIM DYNAMIC ロール数

PRINTFORML 다이스 롤

$RE_ROLL
ダイス結果 = (RAND:6) + 1
SELECTCASE ダイス結果
	CASE 1
		PRINTL ┌───┐
		PRINTL │  ＿  │
		PRINTL │＜◎＞│
		PRINTL │  ￣  │
		PRINTL └───┘
	CASE 2
		PRINTL ┌───┐
		PRINTL │●　  │
		PRINTL │　 　 │
		PRINTL │　  ●│
		PRINTL └───┘
	CASE 3
		PRINTL ┌───┐
		PRINTL │● 　 │
		PRINTL │　●　│
		PRINTL │　  ●│
		PRINTL └───┘
	CASE 4
		PRINTL ┌───┐
		PRINTL │●　●│
		PRINTL │　    │
		PRINTL │●　●│
		PRINTL └───┘
	CASE 5
		PRINTL ┌───┐
		PRINTL │●　●│
		PRINTL │　●　│
		PRINTL │●　●│
		PRINTL └───┘
	CASE 6
		PRINTL ┌───┐
		PRINTL │●●●│
		PRINTL │　  　│
		PRINTL │●●●│
		PRINTL └───┘
ENDSELECT

SETVAR @"%듀얼리스트%_ダイス使用_保", 1
ダイス合計 += ダイス結果
ロール数 ++
CALL CARD_FIN_DICE_SET(듀얼리스트,ダイス結果)

PRINTW
SIF ロール数 < ダイス数
	GOTO RE_ROLL

RESULT:1 = ダイス合計
RETURN ダイス結果



@CARD_RANDOM_HAND(듀얼리스트)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 選択カード

$INPUT_HAND_LOOP
選択カード = RAND:99
SIF GETVAR(@"%듀얼리스트%_손패:選択カード") == -1
	GOTO INPUT_HAND_LOOP
RETURN 選択カード


@CARD_GENERATE_HAND(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC コピー先

コピー先 = 現손패(듀얼리스트)
SETVAR @"%듀얼리스트%_손패:コピー先",カードID

CALLFORM CARDNAME_{カードID},"名前"
PRINTFORMW %듀얼리스트%의 패에 %RESULTS%가 추가되었다！


@CARD_GENERATE_DECK(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC コピー先

コピー先 = 現山札数(듀얼리스트)
SETVAR @"%듀얼리스트%_덱:コピー先",カードID

CALLFORM CARDNAME_{カードID},"名前"
PRINTFORMW %듀얼리스트%의 덱에%RESULTS%가 추가되었다！


;ザポルグ追記20250712
@CARD_GENERATE_DECK_EX(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC コピー先

コピー先 = 現EX山札数(듀얼리스트)
SETVAR @"%듀얼리스트%_EX덱:コピー先",カードID

CALLFORM CARDNAME_{カードID},"名前"
PRINTFORMW %듀얼리스트%의 ＥＸ덱에 %RESULTS%가 추가되었다！


;ザポルグ追記20250122
@CARD_GENERATE_GY(듀얼리스트,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC コピー先

コピー先 = 現묘지数(듀얼리스트)
SETVAR @"%듀얼리스트%_묘지:コピー先",カードID

CALLFORM CARDNAME_{カードID},"名前"
PRINTFORMW %듀얼리스트%의 묘지에%RESULTS%가 추가되었다！


@CHECK_PLAYERS_VIT
IF BASE:MASTER:체력 <= 1000
	;SETBGCOLOR C_Drk_RED
	SETCOLOR C_RED
		PRINTL 　　　＊WARNING＊ 
	PRINTFORML 체력이 한계에 가까워져있습니다！
		PRINTL 　　　＊WARNING＊ 	
	RESETCOLOR
ELSEIF BASE:MASTER:체력 > 1000
	RESETBGCOLOR
ENDIF
IF BASE:MASTER:체력 <= 300
	PRINTL 당신은 듀얼중、체력이 다해 쓰러져버렸습니다……。
	자신_듀얼패배플래그 = 4
ENDIF

IF OPPOSER != -1
	IF BASE:OPPOSER:체력 <= 300
		PRINTL 대전 상대는 듀얼중、체력이 다해 쓰러져버렸습니다……。
		상대_듀얼패배플래그 = 4
	ENDIF
ENDIF


@FIELD_INFO_COUNT(듀얼리스트,효과種,설정타입,대상설정)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 대상者
#DIMS DYNAMIC 효과種
#DIM DYNAMIC 설정타입
#DIM DYNAMIC 대상설정
#DIM DYNAMIC カウント数
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB


CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

$INPUT_LOOP
VARSET RESULT

IF 대상설정 == 0
	대상者 = %듀얼리스트%
ELSEIF 대상설정 == 1
	대상者 = %対面者%
ELSEIF 대상설정 == 2
	대상者 = %듀얼리스트%
ENDIF

IF 효과種 == "属"
	FOR カウンタ,1,7
		FOR カウンタB,0,5
			SIF GETVAR(@"%대상者%_필드:カウンタB") == -1
				CONTINUE
			IF GETVAR(@"%대상者%_MZ_属:カウンタB") == カウンタ
				カウント数 += 1
				BREAK
			ENDIF
		NEXT
	NEXT
ELSEIF 효과種 == "種"
	FOR カウンタ,1,20
		FOR カウンタB,0,5
			SIF GETVAR(@"%대상者%_필드:カウンタB") == -1
				CONTINUE
			IF GETVAR(@"%대상者%_MZ_種:カウンタB") == カウンタ
				カウント数 += 1
				BREAK
			ENDIF
		NEXT
	NEXT
ELSEIF 효과種 == "レベル"
	FOR カウンタ,1,20
		FOR カウンタB,0,5
			SIF GETVAR(@"%대상者%_필드:カウンタB") == -1
				CONTINUE
			IF GETVAR(@"%대상者%_MZ_星:カウンタB") == カウンタ
				カウント数 += 1
				BREAK
			ENDIF
		NEXT
	NEXT
ELSE
	FOR カウンタ,0,5
		SIF GETVAR(@"%대상者%_필드:カウンタ") == -1
			CONTINUE
		IF GETVAR(@"%대상者%_MZ_%효과種%:カウンタ") >= 1
			IF 설정타입 == 1
				カウント数 += GETVAR(@"%대상者%_MZ_%효과種%:カウンタ")
			ELSE
				カウント数 += 1
			ENDIF
		ENDIF
	NEXT
ENDIF

IF 대상설정 == 2
	대상설정 = 1
	GOTO INPUT_LOOP
ENDIF
RETURN カウント数




@FIELD_INFO_COUNT_SAME(듀얼리스트,효과種,설정値,특수설정,대상설정)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 대상者
#DIMS DYNAMIC 효과種
#DIM DYNAMIC 효과修正
#DIM DYNAMIC 설정値
#DIM DYNAMIC 대상설정
#DIM DYNAMIC 특수설정
#DIM DYNAMIC カウント数
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB


CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

$INPUT_LOOP
VARSET RESULT

IF 대상설정 == 0
	대상者 = %듀얼리스트%
ELSEIF 대상설정 == 1
	대상者 = %対面者%
ELSEIF 대상설정 == 2
	대상者 = %듀얼리스트%
ENDIF

FOR カウンタ,0,5
	SIF GETVAR(@"%대상者%_필드:カウンタ") == -1
		CONTINUE
	IF 특수설정 == 1
		CALL CARD_EX_FILTER_SET(대상者,"필드",カウンタ,대상者)
		SIF RESULT != 1
			CONTINUE
	ENDIF
	IF GETVAR(@"%대상者%_MZ_%효과種%:カウンタ") == 설정値
		カウント数 += 1
	ENDIF
NEXT

IF 대상설정 == 2
	대상설정 = 1
	GOTO INPUT_LOOP
ENDIF
RETURN カウント数



@SETSAME_INFO(듀얼리스트,효과種,要求数,특수설정)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 효과種
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 要求数
#DIM DYNAMIC 특수설정
#DIM DYNAMIC 素材条件レベル설정,99

VARSET 素材条件レベル설정,-1

IF 효과種 == "レベル"
	FOR カウンタ,1,12
		CALL FIELD_INFO_COUNT_SAME(듀얼리스트,"星",カウンタ,특수설정)
		SIF RESULT < 要求数
			CONTINUE
		素材条件レベル설정:カウンタ = カウンタ
	NEXT
	FOR カウンタ,1,12
		SIF 素材条件レベル:0 <= 0
			素材条件レベル:0 = 99
		素材条件レベル:カウンタ = 素材条件レベル설정:カウンタ
	NEXT
ENDIF


@PRESET_JOKYO

상대_덱:現山札数("상대") = 상대_손패:0
상대_덱:現山札数("상대") = 상대_손패:1
상대_덱:現山札数("상대") = 상대_손패:2
상대_덱:現山札数("상대") = 상대_손패:3
상대_덱:現山札数("상대") = 상대_손패:4
VARSET 상대_손패, -1

자신_덱:現山札数("자신") = 자신_손패:0
자신_덱:現山札数("자신") = 자신_손패:1
자신_덱:現山札数("자신") = 자신_손패:2
자신_덱:現山札数("자신") = 자신_손패:3
자신_덱:現山札数("자신") = 자신_손패:4
VARSET 자신_손패,-1



@CARD_KANPRINT(参照先,場所,カードID,설정플래그,裏側플래그)
#DIMS DYNAMIC 参照先
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID
#DIM DYNAMIC 설정플래그
#DIM DYNAMIC 裏側플래그
#DIMS DYNAMIC 표시名
#DIM DYNAMIC 표시星
#DIM DYNAMIC 표시属
#DIM DYNAMIC 표시種
#DIM DYNAMIC 표시攻
#DIM DYNAMIC 표시守
#DIM DYNAMIC 표시Ｔ
#DIM DYNAMIC 표시CT
#DIM DYNAMIC 표시可否
#DIM DYNAMIC 표시限界
#DIM DYNAMIC 보존する色
#DIMS DYNAMIC 대상者 ;Anonym추가

;Anonym추가
SELECTCASE 参照先
	CASE "상대필드"
		参照先 = 필드
		대상者 = 상대
	CASE "상대마함"
		参照先 = 마함
		대상者 = 상대
	CASE "상대손패"
		参照先 = 손패
		대상者 = 상대
	CASE "상대묘지"
		参照先 = 묘지
		대상者 = 상대
	CASE "상대덱"
		参照先 = 덱
		대상者 = 상대
	CASE "상대EX덱"
		参照先 = EX덱
		대상者 = 상대
	CASE "상대제외"
		参照先 = 제외
		대상者 = 상대	
ENDSELECT

IF オプション_略표시 == 1
	TRYCALLFORM CARDNAME_{カードID}, "略称"
	표시名 = %RESULTS%
	ELSEIF 参照先 == "필드" && 설정플래그 == 0 && 場所 <= 5 && 대상者 != "상대"
	IF GETVAR(@"자신_MZ_変化元ID:場所") > -1
		TRYCALLFORM CARDNAME_{GETVAR(@"자신_MZ_変化元ID:場所")}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{GETVAR(@"자신_MZ_変化元ID:場所")}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ELSEIF GETVARS(@"자신_MZ_改名:場所") != ""
		표시名 = %GETVARS(@"자신_MZ_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"자신_MZ_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
ELSE
	TRYCALLFORM CARDNAME_{カードID}, "名前"
	STRLENS RESULTS
	SIF RESULT >= 40
		표시限界 = 1
	TRYCALLFORM CARDNAME_{カードID}, "名前"
	SUBSTRING RESULTS, 0, 38
	표시名 = %RESULTS%
	ENDIF
ELSEIF 参照先 == "마함" && 설정플래그 == 0 && INRANGE(場所,10,15) && 대상者 != "상대"
	場所 -= 10
	IF GETVARS(@"자신_魔_改名:場所") != ""
		표시名 = %GETVARS(@"자신_魔_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"자신_魔_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
	ELSE
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ENDIF
	場所 += 10
ELSEIF 参照先 == "필드" && 설정플래그 == 0 && INRANGE(場所,2000,2004)
	場所 -= 2000
	IF GETVAR(@"상대_MZ_変化元ID:場所") > -1
		TRYCALLFORM CARDNAME_{GETVAR(@"상대_MZ_変化元ID:場所")}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{GETVAR(@"상대_MZ_変化元ID:場所")}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ELSEIF GETVARS(@"상대_MZ_改名:場所") != ""
		표시名 = %GETVARS(@"상대_MZ_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"상대_MZ_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
	ELSE
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ENDIF
	場所 += 2000
ELSEIF 参照先 == "필드" && 설정플래그 == 0 && INRANGE(場所,0,4) && 대상者 == "상대"
	IF GETVAR(@"상대_MZ_変化元ID:場所") > -1
		TRYCALLFORM CARDNAME_{GETVAR(@"상대_MZ_変化元ID:場所")}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{GETVAR(@"상대_MZ_変化元ID:場所")}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ELSEIF GETVARS(@"상대_MZ_改名:場所") != ""
		표시名 = %GETVARS(@"상대_MZ_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"상대_MZ_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
	ELSE
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ENDIF
ELSEIF 参照先 == "마함" && 설정플래그 == 0 && INRANGE(場所,2010,2014)
	場所 -= 2010
	IF GETVARS(@"상대_魔_改名:場所") != ""
		표시名 = %GETVARS(@"상대_魔_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"상대_魔_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
	ELSE
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ENDIF
	場所 += 2010
ELSEIF 参照先 == "마함" && 설정플래그 == 0 && INRANGE(場所,0,4) && 대상者 == "상대"
	IF GETVARS(@"상대_魔_改名:場所") != ""
		표시名 = %GETVARS(@"상대_魔_改名:場所")%
		STRLENS 표시名
		SIF RESULT >= 40
			표시限界 = 1
		표시名 = %GETVARS(@"상대_魔_改名:場所")%
		SUBSTRING 표시名, 0, 38
		표시名 = %RESULTS%
	ELSE
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		STRLENS RESULTS
		SIF RESULT >= 40
			표시限界 = 1
		TRYCALLFORM CARDNAME_{カードID}, "名前"
		SUBSTRING RESULTS, 0, 38
		표시名 = %RESULTS%
	ENDIF
ELSE
	TRYCALLFORM CARDNAME_{カードID}, "名前"
	STRLENS RESULTS
	SIF RESULT >= 40
		표시限界 = 1
	TRYCALLFORM CARDNAME_{カードID}, "名前"
	SUBSTRING RESULTS, 0, 38
	표시名 = %RESULTS%
ENDIF


IF 参照先 == "필드" && 설정플래그 == 0 && 場所 < 10 && 대상者 != "상대";&& LOCAL == 15
	표시星 = 자신_MZ_星:場所
	TRYCALLFORM CARD_{カードID}, "コスト"
	표시CT = RESULT
	표시星 = 자신_MZ_属:場所
	표시種 = 자신_MZ_種:場所
	표시攻 = 자신_MZ_攻:場所
	표시守 = 자신_MZ_守:場所
	표시Ｔ = 자신_MZ_Ｔ:場所
ELSEIF 参照先 == "필드" && 설정플래그 == 0 && INRANGE(場所,2000,2004)
	場所 -= 2000
	표시星 = GETVAR(@"상대_MZ_星:場所")
	TRYCALLFORM CARD_{カードID}, "コスト"
	표시CT = RESULT
	표시属 = GETVAR(@"상대_MZ_属:場所")
	표시種 = GETVAR(@"상대_MZ_種:場所")
	표시攻 = GETVAR(@"상대_MZ_攻:場所")
	표시守 = GETVAR(@"상대_MZ_守:場所")
	표시Ｔ = GETVAR(@"상대_MZ_Ｔ:場所")
	場所 += 2000
ELSEIF 参照先 == "필드" && 설정플래그 == 0 && INRANGE(場所,0,4) && 대상者 == "상대"
	표시星 = GETVAR(@"상대_MZ_星:場所")
	TRYCALLFORM CARD_{カードID}, "コスト"
	표시CT = RESULT
	표시属 = GETVAR(@"상대_MZ_属:場所")
	표시種 = GETVAR(@"상대_MZ_種:場所")
	표시攻 = GETVAR(@"상대_MZ_攻:場所")
	표시守 = GETVAR(@"상대_MZ_守:場所")
	표시Ｔ = GETVAR(@"상대_MZ_Ｔ:場所")
ELSE
	TRYCALLFORM CARD_{カードID}, "レベル"
	표시星 = RESULT
	TRYCALLFORM CARD_{カードID}, "コスト"
	표시CT = RESULT
	TRYCALLFORM CARD_{カードID}, "속성"
	표시属 = RESULT
	TRYCALLFORM CARD_{カードID}, "종족"
	표시種 = RESULT
	TRYCALLFORM CARD_{カードID}, "攻撃力"
	표시攻 = RESULT
	TRYCALLFORM CARD_{カードID}, "守備力"
	표시守 = RESULT
	TRYCALLFORM CARD_{カードID}, "튜너"
	표시Ｔ = RESULT
ENDIF

SIF 표시属 >= 1
	표시可否 = 1
IF オプション_略표시 == 1
	SELECTCASE 参照先
		CASE "필드"
			PRINTFORM %"필드",6,RIGHT%
		CASE "마함"
			PRINTFORM %"마함",6,RIGHT%
		CASE "손패"
			PRINTFORM %"손패",6,RIGHT%
		CASE "묘지"
			PRINTFORM %"묘지",6,RIGHT%	
		CASE "덱"
			PRINTFORM %"덱",6,RIGHT%
		CASE "EX덱"
			PRINTFORM %"ＥＸ",6,RIGHT%
		CASE "제외"
			PRINTFORM %"제외",6,RIGHT%	
		CASE "戦闘"
			PRINTFORM %"전투",6,RIGHT%

	ENDSELECT
	IF INRANGE(설정플래그,1,30)
		PRINTFORM ({場所,4}) 
	ELSE
		PRINTFORM [{場所,4}]
	ENDIF
	IF 裏側플래그 >= 3
		PRINTFORM 　%"ＵＮＫＮОＷＮ",16,LEFT%
	ELSE
		PRINTFORM 　%표시名,16,LEFT%
	ENDIF
ELSE
	SELECTCASE 参照先
		CASE "필드"
			PRINTFORM %"필드",6,RIGHT%
		CASE "마함"
			PRINTFORM %"마법함정",6,RIGHT%
		CASE "손패"
			PRINTFORM %"손패",6,RIGHT%
		CASE "묘지"
			PRINTFORM %"묘지",6,RIGHT%	
		CASE "덱"
			PRINTFORM %"덱",6,RIGHT%
		CASE "EX덱"
			PRINTFORM %"ＥＸ",6,RIGHT%
		CASE "제외"
			PRINTFORM %"제외",6,RIGHT%
		CASE "戦闘"
			PRINTFORM %"전투",6,RIGHT%
	ENDSELECT
	IF INRANGE(설정플래그,1,30)
		PRINTFORM ({場所,4}) 
	ELSE
		PRINTFORM [{場所,4}] 
	ENDIF
	IF 裏側플래그 >= 3
		PRINTFORM 　%"ＵＮＫＮＯＷＮ",40,LEFT%
	ELSE
		PRINTFORM 　%표시名,40,LEFT%
	ENDIF
ENDIF

IF 표시限界 == 1
	PRINT ..
ELSE
	PRINT 　
ENDIF

IF 표시可否 == 1
	IF 裏側플래그 >= 3 && 参照先 == "필드"
		PRINTFORM /（★ ?）/（？）/？？？？？족/　（공:     ?/방:     ?）（뒤）
	ELSEIF 裏側플래그 >= 3 && 参照先 == "마함"
		PRINTFORM 
	ELSE
		SIF 표시星 >= 1
			PRINTFORM /（★{표시星,2}）
		IF 표시属 >= 1
			IF 표시属 == 1
				PRINTFORM /（%"빛",2%）
			ELSEIF 표시属 == 2
				PRINTFORM /（%"어둠",2%）
			ELSEIF 표시属 == 3
				PRINTFORM /（%"땅",2%）
			ELSEIF 표시属 == 4
				PRINTFORM /（%"물",2%）
			ELSEIF 표시属 == 5
				PRINTFORM /（%"화염",2%）
			ELSEIF 표시属 == 6
				PRINTFORM /（%"바람",2%）
			ELSEIF 표시属 == 7
				PRINTFORM /（%"신",2%）
			ENDIF
		ENDIF
		IF 표시種 >= 1
			PRINTFORM /%GET_TALENTNAME(191,표시種),12,RIGHT%
		ENDIF
		PRINTFORM /　（공:{표시攻,6}/방:{표시守,6}）
		IF 参照先 == "필드"
			보존する色 = GETCOLOR()
			IF 裏側플래그 == 1
				SETCOLOR C_RED
				PRINTFORM （공）
			ELSEIF 裏側플래그 == 2
				SETCOLOR C_AQUA
				PRINTFORM （수）
			ENDIF
			SETCOLOR 보존する色
		ENDIF
		IF 표시CT >= 1
			PRINTFORM /　（코스트:{표시CT,6}）
		ENDIF
		
	ENDIF
ELSE
	PRINTFORM %"",55%
ENDIF

IF 설정플래그 == 1
	PRINTFORM /（파괴내성）
ELSEIF 설정플래그 == 2
	PRINTFORM /（대상내성）
ELSEIF 설정플래그 == 3
	PRINTFORM /（몬스터 효과 내성）
ELSEIF 설정플래그 == 4
	PRINTFORM /（마법 효과 내성）
ELSEIF 설정플래그 == 5
	PRINTFORM /（함정 효과 내성）
ELSEIF 설정플래그 == 6
	PRINTFORM /（공격 불가）
ELSEIF 설정플래그 == 31
	PRINTFORM /(대신 파괴 장착)
ELSEIF 설정플래그 == 35
	PRINTFORM /(프리체인)
ELSEIF 설정플래그 == 36
	PRINTFORM /(효과 후 유발)
ELSEIF 설정플래그 == 37
	PRINTFORM /(발동유발)


ELSEIF INRANGE(설정플래그,100,300)
	IF 설정플래그 == 101
		PRINTFORM /(소환 시 효과)
	ELSEIF 설정플래그 == 102
		PRINTFORM /(특수 소환 시 효과)
	ELSEIF 설정플래그 == 103
		PRINTFORM /(EX특수 소환 시 효과)
	ELSEIF 설정플래그 == 110
		PRINTFORM /(필드→묘지 효과)
	ELSEIF 설정플래그 == 111
		PRINTFORM /(손패→묘지 효과)
	ELSEIF 설정플래그 == 112
		PRINTFORM /(덱→묘지 효과)
	ELSEIF 설정플래그 == 113
		PRINTFORM /(파괴→묘지 효과)
	ELSEIF 설정플래그 == 114
		PRINTFORM /(전투→묘지 효과)
	ELSEIF 설정플래그 == 115 || 설정플래그 == 117
		PRINTFORM /(필드를 벗어난 효과)
	ELSEIF 설정플래그 == 116
		PRINTFORM /(제외됐을 시 효과)
	ELSEIF 설정플래그 == 100 + ターン開始時
		PRINTFORM /(턴 개시시 유발)
	ELSEIF 설정플래그 == 100 + バトル開始時
		PRINTFORM /(배틀 개시시 유발)
	ELSEIF 설정플래그 == 100 + ターン終了時
		PRINTFORM /(턴 종료시 유발)
	ELSEIF 설정플래그 == 100 + バトル終了時
		PRINTFORM /(배틀 종료시 유발)

	ELSEIF 설정플래그 == 100 + 攻撃時誘発
		PRINTFORM /(공격시 유발 유발)
	ELSEIF 설정플래그 == 100 + 攻撃後誘発
		PRINTFORM /(공격후 유발 유발)
	ELSEIF 설정플래그 == 100 + 표시변경誘発
		PRINTFORM /(표시변경 유발)
	ELSEIF 설정플래그 == 100 + リバース誘発
		PRINTFORM /(리버스 유발)

	ELSE
		PRINTFORM /(그 외의 효과)
	ENDIF
ENDIF

PRINTL


@CARD_RECONSTRUCT(듀얼리스트,ゾーン,場所,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 元カード名称
#DIM DYNAMIC カードID
#DIM DYNAMIC 場所

TRYCALLFORM CARDNAME_{GETVAR(@"%듀얼리스트%_%ゾーン%:場所")}, "名前"
元カード名称 = RESULTS

SETVAR @"%듀얼리스트%_%ゾーン%:場所", カードID

TRYCALLFORM CARDNAME_{カードID}, "名前"
PRINTFORMW %ゾーン%의 %元カード名称%는 %RESULTS%로 바뀌었습니다。

@CARD_SET_CATEGORY(듀얼리스트,ゾーン,場所,설정カテ,추가２플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 설정カテ
#DIM DYNAMIC 場所
#DIM DYNAMIC 추가２플래그

IF 추가２플래그 == 0
	IF ゾーン == "필드"
		SETVAR @"%듀얼리스트%_MZ_追カテ:場所", 설정カテ
	ELSEIF ゾーン == "마함"
		SETVAR @"%듀얼리스트%_魔_追カテ:場所", 설정カテ
	ENDIF
ELSE
	IF ゾーン == "필드"
		SETVAR @"%듀얼리스트%_MZ_追カテ2:場所", 설정カテ
	ELSEIF ゾーン == "마함"
		SETVAR @"%듀얼리스트%_魔_追カテ2:場所", 설정カテ
	ENDIF
ENDIF




@CARD_SET_RENAME(듀얼리스트,ゾーン,場所,설정名)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 설정名
#DIM DYNAMIC 場所
IF ゾーン == "필드"
	SETVAR @"%듀얼리스트%_MZ_改名:場所", 설정名
ELSEIF ゾーン == "마함"
	SETVAR @"%듀얼리스트%_魔_改名:場所", 설정名
ENDIF



@LIFE_SET(듀얼리스트,설정ライフ)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 설정ライフ

SETVAR @"ライフ_%듀얼리스트%", 설정ライフ


@CHANGE_BANISH_ID(듀얼리스트,場所,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC カードID
#DIM DYNAMIC 場所

SETVAR @"%듀얼리스트%_除_変化元ID:場所", カードID



@CHAIN_CAN(듀얼리스트,ゾーン,場所,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC ゾーン
#DIMS DYNAMIC 발동カード名
#DIM DYNAMIC カードID
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所


VARSET RESULT
TRYCALLFORM CARD_{カードID}("C불가")
SIF RESULT == 1
	RETURN 1
	

チェーン可否종류 = 종류

VARSET RESULT
TRYCALLFORM CARDCAN_{カードID}(듀얼리스트,チェーン可否,ゾーン,場所)
SIF RESULT == 1
	RETURN 1


IF GETVAR(@"%듀얼리스트%_モン阻害") >= 1
	TRYCALLFORM CARD_{カードID}, "종류"
	SIF INRANGE(RESULT,0,10)
		RETURN 1	
ENDIF

IF GETVAR(@"%듀얼리스트%_通함정阻害") >= 1
	TRYCALLFORM CARD_{カードID}, "종류"
	SIF RESULT == 通常함정
		RETURN 1
ENDIF

IF GETVAR(@"%듀얼리스트%_永함정阻害") >= 1
	TRYCALLFORM CARD_{カードID}, "종류"
	SIF RESULT == 지속함정
		RETURN 1
ENDIF

IF GETVAR(@"%듀얼리스트%_速魔阻害") >= 1
	TRYCALLFORM CARD_{カードID}, "종류"
	SIF RESULT == 速攻마법
		RETURN 1	
ENDIF

IF GETVAR(@"%듀얼리스트%_물属阻害") >= 1
	TRYCALLFORM CARD_{カードID}, "속성"
	SIF RESULT == 물속성
		RETURN 1	
ENDIF
IF GETVARS(@"%듀얼리스트%_カテ阻害") != ""
	TRYCALLFORM CARDNAME_{カードID}, "カテゴリ"
	SIF RESULTS == GETVARS(@"%듀얼리스트%_カテ阻害")
		RETURN 1
ENDIF


RETURN 0

@COLOR_LINE(설정カラー)
#DIM DYNAMIC 설정カラー

SETCOLOR 설정カラー
CUSTOMDRAWLINE ―
RESETCOLOR

@ATTACK_CARD(듀얼리스트,설정種)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 설정種
#DIMS DYNAMIC MZ종류
#DIM DYNAMIC カードID
#DIM DYNAMIC 설정値,20
#DIM DYNAMIC カウンタ
#DIM DYNAMIC カウンタB

IF 설정種 == "속성"
	MZ종류 = 属
ELSEIF 설정種 == "종족"
	MZ종류 = 種
ENDIF
VARSET 설정値, -1
カードID = GETVAR(@"%듀얼리스트%_필드:戦闘場所(듀얼리스트)")

TRYCALLFORM CARD_{カードID},설정種
IF RESULT:1 >= 1
	FOR カウンタ,1,10
		IF RESULT:カウンタ != 0	
			설정値:カウンタB = RESULT:カウンタ
			カウンタB ++
		ENDIF
	NEXT
ENDIF
설정値:カウンタB = GETVAR(@"%듀얼리스트%_MZ_%MZ종류%:戦闘場所(듀얼리스트)")

FOR カウンタ,0,10
	RESULT:カウンタ = 설정値:カウンタ
NEXT
RETURN 설정値

@CAT_CHECK(カテゴリ名,듀얼리스트,場所,対面플래그)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 実行者
#DIMS DYNAMIC カテゴリ名
#DIMS DYNAMIC カード追カテ,10
#DIM DYNAMIC 対面플래그
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID

SIF 場所 == 5
	RETURN 0

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%
IF 対面플래그 == 1
	実行者 = %対面者%
ELSE
	実行者 = %듀얼리스트%
ENDIF
カードID = GETVAR(@"%実行者%_필드:場所")

TRYCALLFORM CARDNAME_{カードID},"カテゴリ"
SIF MATCH(RESULTS, カテゴリ名)
	RETURN 1

カード追カテ = %GETVARS(@"%実行者%_MZ_追カテ:場所")%
カード追カテ:1 = %GETVARS(@"%実行者%_MZ_追カテ2:場所")%
SIF MATCH(カード追カテ, カテゴリ名)
	RETURN 1
RETURN 0


;―――――――――――――――――――――――――――――――――――――――――――――――――――――――


@CARDNAME_999999,参照先
;ココで지정カードの名前、略称を返す予定
#DIMS DYNAMIC 参照先

VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "名前"
		RESULTS = 각성
	CASE "略称"
		RESULTS = 각성
	CASE "カテゴリ"
		RESULTS:0 = 시스템
ENDSELECT


@CARD_999999(参照先)

#DIMS DYNAMIC 参照先
VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "종류"
		RETURN システム
ENDSELECT

RETURN 0

@CARD_EXPLANATION_999999(종류)
#DIM DYNAMIC 종류

PRINTL 발동한 카드를 각성상태로 한다。
PRINTL 각성은 1턴에 1번밖에 할 수 없다。
PRINTL 
PRINTL 
PRINTL 


@CARDCAN_999999(듀얼리스트,종류,ゾーン,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所

RETURN 1

@覚醒횟수(듀얼리스트)
#FUNCTION
#DIMS DYNAMIC 듀얼리스트
#DIM DYNAMIC 覚醒횟수

覚醒횟수 = GETVAR(@"%듀얼리스트%_覚醒횟수")
RETURNF 覚醒횟수


;―――――――――――――――――――――――――――――――――――――――――――――――――――――――



@CARDNAME_999990,参照先
;ココで지정カードの名前、略称を返す予定
#DIMS DYNAMIC 参照先

VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "名前"
		RESULTS = ＵＮＫＮОＷＮ
	CASE "略称"
		RESULTS = ＵＮＫＮОＷＮ
	CASE "カテゴリ"
		RESULTS:0 = 시스템
ENDSELECT

@CARD_999990(参照先)
#DIMS DYNAMIC 参照先
VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "종류"
		RETURN システム
ENDSELECT

RETURN 0

@CARD_EXPLANATION_999990(종류)
#DIM DYNAMIC 종류

PRINTL 뒤집어진 카드。
PRINTL 
PRINTL 
PRINTL 

@CARDCAN_999990(듀얼리스트,종류,ゾーン,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所

RETURN 1

;―――――――――――――――――――――――――――――――――――――――――――――――――――――――

@CARDNAME_999998,参照先
;ココで지정カードの名前、略称を返す予定
#DIMS DYNAMIC 参照先

VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "名前"
		RESULTS = 사용불가 존
	CASE "略称"
		RESULTS = 사용불가
	CASE "カテゴリ"
		RESULTS:0 = 시스템
ENDSELECT


@CARD_999998(参照先)

#DIMS DYNAMIC 参照先
VARSET RESULT
VARSET RESULTS

SELECTCASE 参照先
	CASE "종류"
		RETURN システム
ENDSELECT

RETURN 0

@CARD_EXPLANATION_999998(종류)
#DIM DYNAMIC 종류

PRINTL 이 필드는 사용불가능하다。
PRINTL 
PRINTL 
PRINTL 
PRINTL 


@CARDCAN_999998(듀얼리스트,종류,ゾーン,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所

RETURN 0

;―――――――――――――――――――――――――――――――――――――――――――――――――――――――


@CARDEFFECT_999997(듀얼리스트,종류,ゾーン,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 選択カード
#DIM DYNAMIC 条件달성
#DIM DYNAMIC 조교대상
#DIM DYNAMIC ダメージ量
#DIMS DYNAMIC 対面者

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF 종류 == ライフ変強制誘発
	ダメージ量 = ダメージ受値
	SIF ダメージ量 < 100
		ダメージ量 = 100
	SIF ダメージ量 > 2000
		ダメージ量 = 1980 + (ダメージ量 / 100)
	SIF ダメージ量 > 40000
		ダメージ量 = 39600 + (ダメージ量 / 100)
	CALL CARD_EROTICS(상대プレイヤー,듀얼리스트)
	IF RESULT != -1
		조교대상 = RESULT
		PRINTFORML
		SETCOLOR C_PINK 
		PRINTFORML %CALLNAME:조교대상%은 받은 데미지와 동등한 리얼데미지를 받았다！
		RESETCOLOR
		CALL EROTIC_MOVE("追い打ち",조교대상,,ダメージ量)
	ENDIF
ENDIF






@RESRICT_FIELD(듀얼리스트,ゾーン,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所

CALL 対面者판정(듀얼리스트)
対面者 = %RESULTS%

IF モンスター数(対面者) >= 5
	PRINTFORML 이 이상 필드를 좁게할수 없습니다。
	RETURN 0
ENDIF

IF ゾーン == "필드"
	SETVAR @"%対面者%_MZ_汎数:現필드(対面者)", 場所
ELSEIF ゾーン == "마함"
	SETVAR @"%対面者%_MZ_汎数:現필드(対面者)", 場所 + 10
ENDIF
SETVAR @"%対面者%_필드:現필드(対面者)", 使用불가ゾーン

RETURN 1

@GET_FIGHT_CAT(듀얼리스트,カテゴリ)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC カテゴリ
#DIMS DYNAMIC カード追カテ,10
#DIM DYNAMIC リザルト
#DIM DYNAMIC 対面플래그

#DIM DYNAMIC 場所

場所 = 戦闘場所(듀얼리스트)
IF 場所 == 5
	RETURN 0
ENDIF
カード追カテ:0 = %GETVARS(@"%듀얼리스트%_MZ_追カテ:場所")%
カード追カテ:1 = %GETVARS(@"%듀얼리스트%_MZ_追カテ2:場所")%
TRYCALLFORM CARDNAME_{戦闘カードID(듀얼리스트)},"カテゴリ"
SIF MATCH(RESULTS,カテゴリ)
	RETURN 1
SIF MATCH(カード追カテ,カテゴリ)
	RETURN 1
RETURN 0

@GET_FIELD_NAME(듀얼리스트,場所)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC カテゴリ
#DIMS DYNAMIC 選択カード名前
#DIM DYNAMIC リザルト
#DIM DYNAMIC 場所

VARSET 選択カード名前
TRYCALLFORM CARDNAME_{GETVAR(@"%듀얼리스트%_필드:場所")}, "名前"
選択カード名前 = %RESULTS%
SIF 選択カード名前 == ""
	RETURN 0

SIF GETVARS(@"%듀얼리스트%_MZ_改名:場所") != ""
    選択カード名前 = %GETVARS(@"%듀얼리스트%_MZ_改名:場所") %

RESULTS = %選択カード名前%
RETURN 1

;--------------------------------------------------------------------------------------------------
;코인토스
;--------------------------------------------------------------------------------------------------
@COIN_TOSS(試行횟수)
#DIM DYNAMIC 試行횟수
#DIM DYNAMIC 表횟수
#DIM DYNAMIC 裏횟수
PRINTW 코인토스！

SIF 試行횟수 == 0
	試行횟수 = 1
REPEAT 試行횟수

	IF RAND:2 == 0
		PRINTFORML  　＿＿＿＿　
		PRINTFORML  ／　　　　＼
		PRINTFORML │　　△　　│
		PRINTFORML │　＜◎＞　│
		PRINTFORML │　　▽　　│
		PRINTFORML  ＼＿＿＿＿／
		PRINTFORML 
		PRINTW 앞이 나왔습니다
		表횟수 ++ 
	ELSE
		PRINTFORML  　＿＿＿＿
		PRINTFORML  ／　　　　＼
		PRINTFORML │　　　　　│
		PRINTFORML │　　　　　│
		PRINTFORML │　　　　　│
		PRINTFORML  ＼＿＿＿＿／
		PRINTFORML 
		PRINTW 뒤가 나왔습니다
		裏횟수 ++ 
	ENDIF
REND
RESULT:1 = 裏횟수
RETURN 表횟수



;--------------------------------------------------------------------------------------------------
;아르카나 설정
;--------------------------------------------------------------------------------------------------

@ARCANA_SET(듀얼리스트,ゾーン,場所,カードID)
#DIMS DYNAMIC 듀얼리스트
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 종류
#DIM DYNAMIC 場所
#DIM DYNAMIC カードID
#DIM DYNAMIC 運命보존

;結界確認
IF GETVARS(@"%듀얼리스트%_フィールド名") == "光の結界"
	PRINTL 【운명을 선택】
	PRINTL
	PRINTL [1] - 정위치
	PRINTL [2] - 역위치
	BINPUT
ELSE
	RESULT = RAND:2 + 1
ENDIF

;正위치
IF RESULT == 1
	PRINTL ┌─────────────┐
	PRINTL │　　　　　　　　　　　 〇 │
	PRINTL │　┌─────────┐　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　└─────────┘　│
	PRINTL │ ┌──────────┐ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ └──────────┘ │
	PRINTL └─────────────┘
	WAIT
	PRINTL
	PRINTW 정위치！
	運命보존 = 1

;逆위치
ELSEIF RESULT == 2
	PRINTL ┌─────────────┐
	PRINTL │ ┌──────────┐ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ │　　　　　　　　　　│ │
	PRINTL │ └──────────┘ │
	PRINTL │　┌─────────┐　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　│　　　　　　　　　│　│
	PRINTL │　└─────────┘　│
	PRINTL │ 〇 　　　　　　　　　　　│
	PRINTL └─────────────┘
	WAIT
	PRINTL
	PRINTW 역위치！
	運命보존 = 2
ENDIF

IF ゾーン == "필드"
	CALL SET_FIELD_INFO(듀얼리스트,"필드",場所,"汎数",運命보존,1)
ELSE
	TRYCALLFORM CARD_{カードID},"종류"
	IF GROUPMATCH(RESULT,フィールド,지속마법)
		CALL SET_FIELD_INFO(듀얼리스트,"마함",場所,"汎数",運命보존,1)
	ENDIF
ENDIF

RETURN 運命보존
